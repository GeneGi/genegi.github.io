<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Seattle Puzzles - A beautiful puzzle game featuring Chinese poetry riddles about Seattle landmarks">
    
    <!-- Firebase SDK -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
      import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";
      
      // Your web app's Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyDHyayHDdBCdtGOrWhUq6QHk4iPS2QJDnc",
        authDomain: "seattlepuzzle-fcd89.firebaseapp.com",
        projectId: "seattlepuzzle-fcd89",
        storageBucket: "seattlepuzzle-fcd89.firebasestorage.app",
        messagingSenderId: "791934150017",
        appId: "1:791934150017:web:58827f896c2b453bb67480",
        measurementId: "G-9BQ7KQMDN0"
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      
      // Generate session ID
      const sessionId = 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
      
      // Make Firebase functions globally available
      window.trackPuzzleEvent = async function(eventData) {
        try {
          await addDoc(collection(db, "puzzle_events"), {
            ...eventData,
            sessionId: sessionId,
            timestamp: serverTimestamp(),
            userAgent: navigator.userAgent,
            screenSize: `${screen.width}x${screen.height}`,
            url: window.location.href
          });
          console.log('Event tracked successfully');
        } catch (error) {
          console.error('Error tracking event:', error);
          // Fallback to console log if Firebase fails
          console.log('Fallback tracking:', eventData);
        }
      };
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>{{ .Title }} - {{ .Site.Title }}</title>
    <meta name="description" content="{{ .Description }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Apple Glass Design */
        /* iOS Safari specific fixes */
        @media (max-width: 768px) {
            /* Fix iOS Safari viewport issues */
            body {
                -webkit-text-size-adjust: 100%;
                -ms-text-size-adjust: 100%;
            }
            
            /* Fix iOS Safari input zoom */
            input, textarea, select {
                font-size: 16px !important;
                transform: translateZ(0);
                -webkit-appearance: none;
                border-radius: 0;
            }
            
            /* Fix iOS Safari button styling */
            button {
                -webkit-appearance: none;
                border-radius: 0;
                cursor: pointer;
            }
            
            /* Prevent iOS Safari from adding blue highlight */
            * {
                -webkit-tap-highlight-color: transparent;
                -webkit-touch-callout: none;
            }
            
            /* Fix iOS Safari backdrop-filter performance */
            .glass-container {
                transform: translateZ(0);
                -webkit-transform: translateZ(0);
                will-change: transform;
            }
            
            /* Improve scrolling on iOS */
            body {
                -webkit-overflow-scrolling: touch;
                overflow-scrolling: touch;
            }
        }

        /* Mobile Responsive Design */
        @media (max-width: 768px) {
            body {
                padding: 10px;
                font-size: 16px;
                line-height: 1.5;
                /* Force visible background for mobile */
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
                background-attachment: scroll !important;
                background-repeat: no-repeat !important;
                background-size: cover !important;
                min-height: 100vh !important;
                min-height: 100dvh !important; /* Dynamic viewport height for mobile */
            }
            
            /* Ensure HTML and body cover full screen */
            html {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
                background-color: #667eea !important; /* Fallback solid color */
                min-height: 100vh !important;
                min-height: 100dvh !important;
            }
            
            /* Additional mobile background fixes */
            body::before {
                content: '';
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                z-index: -1;
                pointer-events: none;
            }
            
            .glass-container {
                margin: 15px auto;
                padding: 20px;
                max-width: 95%;
                min-height: auto;
                /* Mobile fallback without backdrop-filter */
                background: rgba(255, 255, 255, 0.9) !important;
                backdrop-filter: none !important;
                -webkit-backdrop-filter: none !important;
                border: 1px solid rgba(255, 255, 255, 0.5);
                border-radius: 20px;
                box-shadow: 
                    0 8px 32px rgba(31, 38, 135, 0.37),
                    inset 0 1px 0 rgba(255, 255, 255, 0.5);
                color: #333 !important;
            }
            
            /* Mobile-optimized player info bar */
            #player-info-bar {
                padding: 15px !important;
                margin: 10px auto 15px auto !important;
            }
            
            /* Mobile puzzle navigation improvements */
            #puzzle-nav {
                display: grid !important;
                grid-template-columns: 1fr 1fr !important;
                gap: 8px !important;
                margin-top: 10px !important;
            }
            
            .puzzle-nav-btn {
                padding: 12px 8px !important;
                font-size: 0.75rem !important;
                min-height: 44px !important; /* iOS touch target minimum */
                border-radius: 8px !important;
                background: rgba(255, 255, 255, 0.95) !important;
                color: #333 !important;
                border: 1px solid rgba(0, 0, 0, 0.1) !important;
                font-weight: 600 !important;
                text-align: center !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                line-height: 1.2 !important;
                word-break: break-word !important;
            }
            
            /* Mobile progress bar improvements */
            #progress-text {
                font-size: 0.8rem !important;
                font-weight: 600 !important;
                color: #333 !important;
            }
            
            #progress-bar {
                height: 8px !important;
                border-radius: 4px !important;
            }
            
            /* Mobile player name display */
            #player-name-display {
                font-size: 1rem !important;
                color: #333 !important;
                font-weight: 700 !important;
            }
            
            /* Mobile change name button */
            #change-name-btn {
                font-size: 0.75rem !important;
                padding: 8px 12px !important;
                background: #7877c6 !important;
                color: white !important;
                -webkit-text-fill-color: white !important;
                border: 1px solid #5a59a3 !important;
                font-weight: 600 !important;
                min-height: 36px !important;
                backdrop-filter: none !important;
                -webkit-backdrop-filter: none !important;
                text-shadow: none !important;
                opacity: 1 !important;
            }
            
            /* Ensure change name button text is always visible */
            #change-name-btn:hover,
            #change-name-btn:focus,
            #change-name-btn:active {
                background: #6a69b5 !important;
                color: white !important;
                -webkit-text-fill-color: white !important;
            }
            
            .puzzle-container {
                padding: 25px 20px;
            }
            
            .puzzle-spacing {
                margin-bottom: 20px;
            }
            
            .glass-title {
                font-size: 24px;
                margin-bottom: 15px;
                line-height: 1.3;
                color: #333 !important;
            }
            
            .glass-subtitle {
                font-size: 16px;
                line-height: 1.6;
                margin-bottom: 20px;
                padding: 0 5px;
                color: #555 !important;
            }
            
            .glass-input {
                margin: 20px 0;
            }
            
            .glass-input input {
                font-size: 16px;
                padding: 15px;
                border-radius: 12px;
                width: 100%;
                box-sizing: border-box;
                /* Mobile fallback styling */
                background: rgba(255, 255, 255, 0.95) !important;
                border: 1px solid rgba(0, 0, 0, 0.1);
                color: #333 !important;
                /* Force dark text color */
                -webkit-text-fill-color: #333 !important;
            }
            
            .glass-input input::placeholder {
                color: #666 !important;
                opacity: 1 !important;
            }
            
            .glass-button {
                font-size: 16px;
                padding: 15px 25px;
                border-radius: 12px;
                margin-top: 15px !important;
                min-height: 50px;
                touch-action: manipulation;
                /* Mobile fallback styling */
                background: rgba(120, 119, 198, 0.9) !important;
                color: white !important;
                border: 1px solid rgba(255, 255, 255, 0.3);
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
                /* Force white text color */
                -webkit-text-fill-color: white !important;
            }
            
            /* CRITICAL: Override all glass input styles for mobile visibility */
            .glass-input input,
            .glass-input input:focus,
            .glass-input input:hover,
            .glass-input input:active {
                background: white !important;
                backdrop-filter: none !important;
                -webkit-backdrop-filter: none !important;
                border: 2px solid #ccc !important;
                color: #333 !important;
                -webkit-text-fill-color: #333 !important;
                text-shadow: none !important;
            }
            
            .glass-input input::placeholder {
                color: #666 !important;
                opacity: 1 !important;
                -webkit-text-fill-color: #666 !important;
            }
            
            /* CRITICAL: Override all glass button styles for mobile visibility */
            .glass-button,
            .glass-button:hover,
            .glass-button:focus,
            .glass-button:active,
            button.glass-button,
            form .glass-button,
            #player-name-form .glass-button,
            #puzzle1-form .glass-button,
            #puzzle2-form .glass-button,
            #puzzle3-form .glass-button,
            #puzzle4-form .glass-button {
                background: #7877c6 !important;
                backdrop-filter: none !important;
                -webkit-backdrop-filter: none !important;
                color: white !important;
                -webkit-text-fill-color: white !important;
                border: 2px solid #5a59a3 !important;
                text-shadow: none !important;
                font-weight: 600 !important;
                opacity: 1 !important;
                text-decoration: none !important;
                font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif !important;
            }
            
            .glass-message {
                font-size: 14px;
                padding: 12px;
                border-radius: 10px;
                margin-top: 15px;
            }
            
            /* Better text rendering on mobile */
            * {
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
            }
            
            /* CLEAR SUCCESS/FAILURE MESSAGES FOR MOBILE */
            .glass-message {
                font-size: 16px !important;
                padding: 20px !important;
                border-radius: 15px !important;
                margin: 20px 0 !important;
                text-align: center !important;
                font-weight: 600 !important;
                border: 3px solid !important;
                backdrop-filter: none !important;
                -webkit-backdrop-filter: none !important;
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3) !important;
            }
            
            /* SUCCESS MESSAGE - Green */
            .glass-message.positive,
            .glass-message.success-message {
                background: #34c759 !important;
                color: white !important;
                -webkit-text-fill-color: white !important;
                border-color: #30d158 !important;
                text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3) !important;
            }
            
            /* FAILURE MESSAGE - Red */
            .glass-message.negative {
                background: #ff453a !important;
                color: white !important;
                -webkit-text-fill-color: white !important;
                border-color: #ff6961 !important;
                text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3) !important;
            }
            
            /* Add icons and animations */
            .glass-message.positive::before {
                content: "✅ ";
                font-size: 20px;
                margin-right: 8px;
            }
            
            .glass-message.negative::before {
                content: "❌ ";
                font-size: 20px;
                margin-right: 8px;
            }
            
            /* CRITICAL: Fix Change Name button visibility on mobile */
            #change-name-btn,
            button#change-name-btn,
            .glass-container #change-name-btn,
            #player-info-bar #change-name-btn {
                background: #7877c6 !important;
                background-color: #7877c6 !important;
                color: #000000 !important;
                -webkit-text-fill-color: #000000 !important;
                text-shadow: none !important;
                backdrop-filter: none !important;
                -webkit-backdrop-filter: none !important;
                border: 2px solid #333333 !important;
                font-weight: 700 !important;
                opacity: 1 !important;
                font-size: 0.75rem !important;
                padding: 8px 12px !important;
                min-height: 36px !important;
                border-radius: 8px !important;
                text-decoration: none !important;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
            }
            
            #change-name-btn:hover,
            #change-name-btn:focus,
            #change-name-btn:active,
            button#change-name-btn:hover,
            button#change-name-btn:focus,
            button#change-name-btn:active {
                background: #6a69b5 !important;
                background-color: #6a69b5 !important;
                color: #000000 !important;
                -webkit-text-fill-color: #000000 !important;
                border: 2px solid #333333 !important;
            }
            
            /* Alternative high contrast version */
            @supports not (backdrop-filter: blur(10px)) {
                #change-name-btn {
                    background: #ffffff !important;
                    background-color: #ffffff !important;
                    color: #333333 !important;
                    -webkit-text-fill-color: #333333 !important;
                    border: 2px solid #7877c6 !important;
                }
            }
        }

        /* Security and anti-inspection styles */
        * {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* Allow text selection only in input fields */
        input, textarea {
            -webkit-user-select: text !important;
            -moz-user-select: text !important;
            -ms-user-select: text !important;
            user-select: text !important;
        }
        
        /* Prevent image dragging */
        img {
            -webkit-user-drag: none;
            -khtml-user-drag: none;
            -moz-user-drag: none;
            -o-user-drag: none;
            user-drag: none;
            pointer-events: none;
        }
        
        /* Hide scrollbars to make inspection harder */
        ::-webkit-scrollbar {
            width: 0px;
            background: transparent;
        }
        
        body {
            background: 
                linear-gradient(135deg, #667eea 0%, #764ba2 100%),
                radial-gradient(circle at 30% 40%, rgba(120, 119, 198, 0.3), transparent 50%),
                radial-gradient(circle at 80% 10%, rgba(255, 255, 255, 0.15), transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(120, 119, 198, 0.2), transparent 50%);
            background-attachment: fixed;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Helvetica Neue', Arial, sans-serif;
            color: rgba(255, 255, 255, 0.9);
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            position: relative;
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 255, 255, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(255, 255, 255, 0.08) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }
        
        input, textarea {
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }
        
        /* Apple Glass Header */
        .glass-header {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
            font-weight: 700;
            font-size: 2.5rem;
            color: rgba(255, 255, 255, 0.95);
            text-align: center;
            margin-bottom: 2rem;
            letter-spacing: -0.02em;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.6));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        /* Glass Morphism Containers */
        .glass-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            padding: 2rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .glass-container:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-4px);
            box-shadow: 
                0 12px 40px rgba(0, 0, 0, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }
        
        /* Apple Style Buttons */
        .glass-button {
            background: rgba(255, 255, 255, 0.2) !important;
            backdrop-filter: blur(10px) !important;
            -webkit-backdrop-filter: blur(10px) !important;
            border: 1px solid rgba(255, 255, 255, 0.3) !important;
            border-radius: 12px !important;
            color: rgba(255, 255, 255, 0.95) !important;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif !important;
            font-weight: 600 !important;
            font-size: 1rem !important;
            padding: 12px 24px !important;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1) !important;
            cursor: pointer !important;
            text-shadow: none !important;
            box-shadow: 
                0 4px 16px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.2) !important;
        }
        
        .glass-button:hover {
            background: rgba(255, 255, 255, 0.3) !important;
            transform: translateY(-1px) !important;
            box-shadow: 
                0 6px 20px rgba(0, 0, 0, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.3) !important;
        }
        
        .glass-button:active {
            transform: translateY(0) !important;
            background: rgba(255, 255, 255, 0.25) !important;
        }
        
        /* Glass Input Fields */
        .glass-input input {
            background: rgba(255, 255, 255, 0.08) !important;
            backdrop-filter: blur(20px) !important;
            -webkit-backdrop-filter: blur(20px) !important;
            border: 1px solid rgba(255, 255, 255, 0.15) !important;
            border-radius: 16px !important;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif !important;
            color: rgba(255, 255, 255, 0.95) !important;
            font-size: 1.1rem !important;
            font-weight: 500 !important;
            padding: 20px 24px !important;
            width: 100% !important;
            box-sizing: border-box !important;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
            text-align: center !important;
            letter-spacing: 0.01em !important;
            box-shadow: 
                0 4px 20px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.1) !important;
        }
        
        .glass-input input::placeholder {
            color: rgba(255, 255, 255, 0.4) !important;
            font-weight: 400 !important;
            text-align: center !important;
        }
        
        .glass-input input:focus {
            background: rgba(255, 255, 255, 0.12) !important;
            border-color: rgba(255, 255, 255, 0.3) !important;
            box-shadow: 
                0 0 0 4px rgba(255, 255, 255, 0.08),
                0 8px 32px rgba(0, 0, 0, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.2) !important;
            outline: none !important;
            transform: translateY(-2px) !important;
        }
        
        .glass-input input:hover:not(:focus) {
            background: rgba(255, 255, 255, 0.1) !important;
            border-color: rgba(255, 255, 255, 0.2) !important;
            transform: translateY(-1px) !important;
        }
        
        /* Typography */
        .glass-title {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
            font-weight: 700;
            font-size: 1.75rem;
            color: rgba(255, 255, 255, 0.95);
            margin-bottom: 1rem;
            letter-spacing: -0.01em;
        }
        
        .glass-subtitle {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif;
            font-weight: 400;
            font-size: 1.1rem;
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.5;
            margin-bottom: 1.5rem;
        }
        
        /* Apple-style transition effects */
        .glass-glow {
            animation: glassGlow 2s ease-in-out;
        }
        
        @keyframes glassGlow {
            0% { 
                transform: scale(1);
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            }
            50% { 
                transform: scale(1.02);
                box-shadow: 
                    0 12px 40px rgba(255, 255, 255, 0.2),
                    0 0 60px rgba(255, 255, 255, 0.1);
            }
            100% { 
                transform: scale(1);
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            }
        }
        
        .success-message {
            animation: successSlide 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes successSlide {
            0% { 
                opacity: 0; 
                transform: translateY(-20px) scale(0.95); 
            }
            100% { 
                opacity: 1; 
                transform: translateY(0) scale(1); 
            }
        }
        
        /* Error shake animation for wrong answers */
        .error-shake {
            animation: errorShake 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes errorShake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-8px); }
            20%, 40%, 60%, 80% { transform: translateX(8px); }
        }
        
        /* Input field error animation */
        .input-error {
            animation: inputError 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes inputError {
            0% { border-color: rgba(255, 255, 255, 0.15); }
            50% { 
                border-color: rgba(255, 69, 58, 0.8); 
                box-shadow: 0 0 0 4px rgba(255, 69, 58, 0.2);
            }
            100% { border-color: rgba(255, 255, 255, 0.15); }
        }
        
        /* Button press animation */
        .button-press {
            animation: buttonPress 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes buttonPress {
            0% { transform: scale(1); }
            50% { transform: scale(0.95); }
            100% { transform: scale(1); }
        }
        
        /* Message slide in animation */
        .message-slide-in {
            animation: messageSlideIn 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes messageSlideIn {
            0% { 
                opacity: 0; 
                transform: translateY(20px) scale(0.9); 
            }
            100% { 
                opacity: 1; 
                transform: translateY(0) scale(1); 
            }
        }
        
        .puzzle-container {
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .fade-out {
            opacity: 0;
            transform: translateY(-30px) scale(0.95);
        }
        
        .fade-in {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
        
        /* Message styling */
        .glass-message {
            background: rgba(255, 255, 255, 0.15) !important;
            backdrop-filter: blur(20px) !important;
            -webkit-backdrop-filter: blur(20px) !important;
            border: 1px solid rgba(255, 255, 255, 0.2) !important;
            border-radius: 16px !important;
            color: rgba(255, 255, 255, 0.9) !important;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif !important;
            font-weight: 500 !important;
            padding: 16px 20px !important;
        }
        
        .glass-message.positive {
            background: rgba(52, 199, 89, 0.2) !important;
            border-color: rgba(52, 199, 89, 0.3) !important;
        }
        
        .glass-message.negative {
            background: rgba(255, 69, 58, 0.2) !important;
            border-color: rgba(255, 69, 58, 0.3) !important;
        }
        
        /* Container spacing */
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }
        
        .puzzle-spacing {
            margin: 3rem auto;
        }


    </style>
</head>
<body>

    <!-- Puzzle Game Section -->
    <div class="container">
        <h1 class="glass-header">Seattle Puzzles</h1>
        
        <!-- Player Info Bar (shown when player name exists) -->
        <div id="player-info-bar" class="glass-container" style="display: none; margin-bottom: 2rem; padding: 1.5rem;">
            <!-- Mobile-optimized layout -->
            <div style="margin-bottom: 1rem;">
                <!-- Player name and change button - mobile stacked -->
                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 1rem;">
                    <div style="flex: 1; min-width: 0;">
                        <div style="font-size: 0.9rem; font-weight: 500; opacity: 0.8; margin-bottom: 0.2rem;">Welcome back</div>
                        <div id="player-name-display" style="font-size: 1.1rem; font-weight: 600; color: rgba(255, 255, 255, 0.95); word-break: break-word;"></div>
                    </div>
                    <button id="change-name-btn" class="glass-button" style="font-size: 0.8rem; padding: 6px 12px; background: rgba(255, 255, 255, 0.1) !important; white-space: nowrap; flex-shrink: 0;">
                        Change Name
                    </button>
                </div>
                
                <!-- Progress section -->
                <div style="margin-bottom: 1rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                        <span style="font-size: 0.85rem; opacity: 0.8;">Progress</span>
                        <span id="progress-text" style="font-size: 0.85rem; font-weight: 500;"></span>
                    </div>
                    <div style="background: rgba(255, 255, 255, 0.1); border-radius: 8px; height: 6px; overflow: hidden;">
                        <div id="progress-bar" style="background: linear-gradient(90deg, #34c759, #30d158); height: 100%; width: 0%; transition: width 0.3s ease;"></div>
                    </div>
                </div>
            </div>
            
            <!-- Mobile-optimized puzzle navigation -->
            <div id="puzzle-nav" style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
                <button class="puzzle-nav-btn" data-puzzle="1" style="padding: 10px 8px; border-radius: 8px; font-size: 0.8rem; border: 1px solid rgba(255, 255, 255, 0.2); background: rgba(255, 255, 255, 0.1); color: rgba(255, 255, 255, 0.9); cursor: pointer; transition: all 0.2s; text-align: center; min-height: 40px; display: flex; align-items: center; justify-content: center;">Puzzle 1</button>
                <button class="puzzle-nav-btn" data-puzzle="2" style="padding: 10px 8px; border-radius: 8px; font-size: 0.8rem; border: 1px solid rgba(255, 255, 255, 0.2); background: rgba(255, 255, 255, 0.1); color: rgba(255, 255, 255, 0.9); cursor: pointer; transition: all 0.2s; text-align: center; min-height: 40px; display: flex; align-items: center; justify-content: center;">Puzzle 2</button>
                <button class="puzzle-nav-btn" data-puzzle="3" style="padding: 10px 8px; border-radius: 8px; font-size: 0.8rem; border: 1px solid rgba(255, 255, 255, 0.2); background: rgba(255, 255, 255, 0.1); color: rgba(255, 255, 255, 0.9); cursor: pointer; transition: all 0.2s; text-align: center; min-height: 40px; display: flex; align-items: center; justify-content: center;">Puzzle 3</button>
                <button class="puzzle-nav-btn" data-puzzle="4" style="padding: 10px 8px; border-radius: 8px; font-size: 0.8rem; border: 1px solid rgba(255, 255, 255, 0.2); background: rgba(255, 255, 255, 0.1); color: rgba(255, 255, 255, 0.9); cursor: pointer; transition: all 0.2s; text-align: center; min-height: 40px; display: flex; align-items: center; justify-content: center;">Puzzle 4</button>
            </div>
        </div>
        
        <!-- Player Name Input -->
        <div id="player-name-section" class="glass-container puzzle-spacing">
            <div class="glass-title" style="text-align:center;">Welcome, Puzzle Solver!</div>
            <div class="glass-subtitle" style="text-align:center;">
                Before we begin your Seattle adventure,<br>
                what should we call you?
            </div>
            <form id="player-name-form" class="glass-input" style="margin: 2rem 0;">
                <input type="text" id="player-name-input" placeholder="Enter your name" required maxlength="50">
                <button class="glass-button" type="submit" style="width:100%; margin-top: 24px;">Start Adventure</button>
            </form>
        </div>
        
        <!-- Puzzle 1 -->
        <div id="puzzle1" class="glass-container puzzle-container puzzle-spacing" style="display: none; opacity: 0;">
            <div class="glass-title" style="text-align:center;">Puzzle 1</div>
            <div id="welcome-message" class="glass-subtitle" style="text-align:center; margin-bottom: 1rem;">
                <!-- Welcome message will be inserted here -->
            </div>
            <div class="glass-subtitle" style="text-align:center;">
                三球如梦，藏林于城。<br>
                镜影如诗，谜途始发。
            </div>
            <form id="puzzle1-form" class="glass-input" style="margin: 2rem 0;">
                <input type="text" placeholder="Enter your answer" required>
                <button class="glass-button" type="submit" style="width:100%; margin-top: 24px;">Submit</button>
            </form>
            <div id="puzzle1-message" class="glass-message" style="display:none; margin-top: 20px;"></div>
        </div>

        <!-- Puzzle 2 -->
        <div id="puzzle2" class="glass-container puzzle-container puzzle-spacing" style="display: none; opacity: 0;">
            <div class="glass-title" style="text-align:center;">Puzzle 2</div>
            <div class="glass-subtitle" style="text-align:center;">
                出球向东北，右转第七街。<br>
                车流交汇处，三角孤岛中。<br>
                形似水泥袋，枕形金属云。<br>
                ——寻觅那云中俳句，<br>
                且听风吟，感其金属之心，是何铸其形？
            </div>
            <form id="puzzle2-form" class="glass-input" style="margin: 2rem 0;">
                <input type="text" placeholder="Enter your answer" required>
                <button class="glass-button" type="submit" style="width:100%; margin-top: 24px;">Submit</button>
            </form>
            <div id="puzzle2-message" class="glass-message" style="display:none; margin-top: 20px;"></div>
        </div>

        <!-- Puzzle 3 -->
        <div id="puzzle3" class="glass-container puzzle-container puzzle-spacing" style="display: none; opacity: 0;">
            <div class="glass-title" style="text-align:center;">Puzzle 3</div>
            <div class="glass-subtitle" style="text-align:center;">
                沿街向北，绿影之侧，<br>
                三人并立，不语凝思。<br>
                童年记忆，铸身为像，<br>
                目光游移，各守心池。<br>
                ——觅那三影静默，<br>
                倾听岁月轻诉，<br>
                哪年春秋，凝铸此形？
            </div>
            <form id="puzzle3-form" class="glass-input" style="margin: 2rem 0;">
                <input type="text" placeholder="Enter your answer" required>
                <button class="glass-button" type="submit" style="width:100%; margin-top: 24px;">Submit</button>
            </form>
            <div id="puzzle3-message" class="glass-message" style="display:none; margin-top: 20px;"></div>
        </div>

        <!-- Puzzle 4 -->
        <div id="puzzle4" class="glass-container puzzle-container puzzle-spacing" style="display: none; opacity: 0;">
            <div class="glass-title" style="text-align:center;">Puzzle 4</div>
            <div class="glass-subtitle" style="text-align:center;">
                告别铜影三人，漫步西湖路，<br>
                棋纹黑与白，点缀几抹朱。<br>
                她俯身入梦，目光越尘雾，<br>
                足托鱼轻跃，心随云起伏。<br>
                ——她是谁？名如其姿，心随远云去。
            </div>
            <form id="puzzle4-form" class="glass-input" style="margin: 2rem 0;">
                <input type="text" placeholder="Enter your answer" required>
                <button class="glass-button" type="submit" style="width:100%; margin-top: 24px;">Submit</button>
            </form>
            <div id="puzzle4-message" class="glass-message" style="display:none; margin-top: 20px;"></div>
        </div>
    </div>

    <script>
    // Player name management with localStorage and puzzle progress
    let playerName = '';
    let puzzleProgress = {
        completed: [], // Array of completed puzzle numbers
        currentPuzzle: 1 // Current puzzle number
    };
    
    // Check for existing player name and progress on page load
    document.addEventListener('DOMContentLoaded', function() {
        const savedPlayerName = localStorage.getItem('seattlePuzzlePlayerName');
        const savedProgress = localStorage.getItem('seattlePuzzleProgress');
        
        if (savedPlayerName) {
            playerName = savedPlayerName;
            
            // Load puzzle progress
            if (savedProgress) {
                try {
                    puzzleProgress = JSON.parse(savedProgress);
                } catch (e) {
                    console.log('Error parsing saved progress, using defaults');
                    puzzleProgress = { completed: [], currentPuzzle: 1 };
                }
            }
            
            // Show player info bar with progress
            showPlayerInfoBar();
            // Skip name input and go directly to current puzzle
            document.getElementById('player-name-section').style.display = 'none';
            showCurrentPuzzle();
            
            // Track returning player with progress
            if (typeof window.trackPuzzleEvent === 'function') {
                window.trackPuzzleEvent({
                    eventType: 'returning_player',
                    playerName: playerName,
                    category: 'game_start',
                    completedPuzzles: puzzleProgress.completed.length,
                    currentPuzzle: puzzleProgress.currentPuzzle
                });
            }
        }
        
        // Set up change name button event listener
        setupChangeNameButton();
    });
    
    // Player name form handler
    document.getElementById('player-name-form').addEventListener('submit', function(e) {
        e.preventDefault();
        console.log('Form submitted'); // Debug log
        
        const nameInput = document.getElementById('player-name-input');
        playerName = nameInput.value.trim();
        console.log('Player name:', playerName); // Debug log
        
        if (playerName.length === 0) {
            console.log('Empty name, returning'); // Debug log
            return;
        }
        
        // Save player name to localStorage
        localStorage.setItem('seattlePuzzlePlayerName', playerName);
        
        // Track player name entry with Firebase
        if (typeof window.trackPuzzleEvent === 'function') {
            window.trackPuzzleEvent({
                eventType: 'player_name_entered',
                playerName: playerName,
                category: 'game_start',
                label: 'player_registration'
            });
        }
        
        // Hide name section and show first puzzle
        const nameSection = document.getElementById('player-name-section');
        const puzzle1 = document.getElementById('puzzle1');
        
        console.log('Name section found:', !!nameSection); // Debug log
        console.log('Puzzle1 found:', !!puzzle1); // Debug log
        
        if (!nameSection || !puzzle1) {
            console.error('Required elements not found');
            return;
        }
        
        nameSection.classList.add('fade-out');
        console.log('Added fade-out class'); // Debug log
        
        setTimeout(() => {
            console.log('Executing transition'); // Debug log
            nameSection.style.display = 'none';
            puzzle1.style.display = 'block';
            puzzle1.classList.add('fade-in');
            puzzle1.style.opacity = '1';
            
            // Show player info bar
            showPlayerInfoBar();
            
            // Update puzzle header to include player name
            updatePuzzleGreeting();
            
            // Initialize game timing
            window.gameStartTime = Date.now();
            window.puzzle1StartTime = Date.now();
            
            console.log('Transition complete'); // Debug log
        }, 1000);
    });
    
    // Function to show player info bar
    function showPlayerInfoBar() {
        const playerInfoBar = document.getElementById('player-info-bar');
        const playerNameDisplay = document.getElementById('player-name-display');
        
        if (playerInfoBar && playerNameDisplay && playerName) {
            playerNameDisplay.textContent = playerName;
            playerInfoBar.style.display = 'block';
            updateProgressDisplay();
            setupPuzzleNavigation();
        }
    }
    
    // Function to update progress display
    function updateProgressDisplay() {
        const progressText = document.getElementById('progress-text');
        const progressBar = document.getElementById('progress-bar');
        const navButtons = document.querySelectorAll('.puzzle-nav-btn');
        
        if (progressText && progressBar) {
            const completedCount = puzzleProgress.completed.length;
            const progressPercent = (completedCount / 4) * 100;
            
            progressText.textContent = `${completedCount}/4 puzzles completed`;
            progressBar.style.width = `${progressPercent}%`;
        }
        
        // Update navigation buttons
        navButtons.forEach(btn => {
            const puzzleNum = parseInt(btn.dataset.puzzle);
            const isCompleted = puzzleProgress.completed.includes(puzzleNum);
            const isCurrent = puzzleNum === puzzleProgress.currentPuzzle;
            const isAccessible = puzzleNum <= puzzleProgress.currentPuzzle;
            
            // Reset styles
            btn.style.background = 'rgba(255, 255, 255, 0.1)';
            btn.style.color = 'rgba(255, 255, 255, 0.9)';
            btn.style.border = '1px solid rgba(255, 255, 255, 0.2)';
            btn.style.cursor = 'pointer';
            btn.style.opacity = '1';
            
            if (isCompleted) {
                // Completed puzzle - green
                btn.style.background = 'rgba(52, 199, 89, 0.3)';
                btn.style.border = '1px solid rgba(52, 199, 89, 0.5)';
                btn.innerHTML = `Puzzle ${puzzleNum} ✓`;
            } else if (isCurrent) {
                // Current puzzle - highlighted
                btn.style.background = 'rgba(255, 255, 255, 0.2)';
                btn.style.border = '1px solid rgba(255, 255, 255, 0.4)';
                btn.innerHTML = `Puzzle ${puzzleNum} →`;
            } else if (!isAccessible) {
                // Locked puzzle - dimmed
                btn.style.opacity = '0.5';
                btn.style.cursor = 'not-allowed';
                btn.innerHTML = `Puzzle ${puzzleNum} 🔒`;
            } else {
                btn.innerHTML = `Puzzle ${puzzleNum}`;
            }
        });
    }
    
    // Function to setup puzzle navigation
    function setupPuzzleNavigation() {
        const navButtons = document.querySelectorAll('.puzzle-nav-btn');
        
        navButtons.forEach(btn => {
            btn.addEventListener('click', function() {
                const puzzleNum = parseInt(this.dataset.puzzle);
                const isAccessible = puzzleNum <= puzzleProgress.currentPuzzle;
                
                if (isAccessible) {
                    navigateToPuzzle(puzzleNum);
                    
                    // Track puzzle navigation
                    if (typeof window.trackPuzzleEvent === 'function') {
                        window.trackPuzzleEvent({
                            eventType: 'puzzle_navigation',
                            playerName: playerName,
                            fromPuzzle: getCurrentVisiblePuzzle(),
                            toPuzzle: puzzleNum,
                            category: 'user_interaction'
                        });
                    }
                }
            });
        });
    }
    
    // Function to navigate to a specific puzzle
    function navigateToPuzzle(puzzleNum) {
        // Hide all puzzles
        for (let i = 1; i <= 4; i++) {
            const puzzle = document.getElementById(`puzzle${i}`);
            if (puzzle) {
                puzzle.style.display = 'none';
                puzzle.style.opacity = '0';
            }
        }
        
        // Show target puzzle
        const targetPuzzle = document.getElementById(`puzzle${puzzleNum}`);
        if (targetPuzzle) {
            targetPuzzle.style.display = 'block';
            targetPuzzle.style.opacity = '1';
            
            // Initialize timing for this puzzle if not already set
            if (!window[`puzzle${puzzleNum}StartTime`]) {
                window[`puzzle${puzzleNum}StartTime`] = Date.now();
            }
        }
        
        updateProgressDisplay();
    }
    
    // Function to show current puzzle based on progress
    function showCurrentPuzzle() {
        navigateToPuzzle(puzzleProgress.currentPuzzle);
        updatePuzzleGreeting();
        
        // Initialize game timing
        if (!window.gameStartTime) {
            window.gameStartTime = Date.now();
        }
        if (!window[`puzzle${puzzleProgress.currentPuzzle}StartTime`]) {
            window[`puzzle${puzzleProgress.currentPuzzle}StartTime`] = Date.now();
        }
    }
    
    // Function to get currently visible puzzle number
    function getCurrentVisiblePuzzle() {
        for (let i = 1; i <= 4; i++) {
            const puzzle = document.getElementById(`puzzle${i}`);
            if (puzzle && puzzle.style.display !== 'none' && puzzle.style.opacity !== '0') {
                return i;
            }
        }
        return 1;
    }
    
    // Function to add visual feedback for user interactions
    function addInteractionFeedback(isCorrect, puzzleNum, inputElement, buttonElement, messageDiv) {
        // Add button press animation
        if (buttonElement) {
            buttonElement.classList.add('button-press');
            setTimeout(() => {
                buttonElement.classList.remove('button-press');
            }, 200);
        }
        
        if (isCorrect) {
            // Success animations
            if (messageDiv) {
                messageDiv.classList.add('success-message', 'message-slide-in');
            }
        } else {
            // Error animations
            const puzzleContainer = document.getElementById(`puzzle${puzzleNum}`);
            
            // Shake the puzzle container
            if (puzzleContainer) {
                puzzleContainer.classList.add('error-shake');
                setTimeout(() => {
                    puzzleContainer.classList.remove('error-shake');
                }, 600);
            }
            
            // Error animation for input field
            if (inputElement) {
                inputElement.classList.add('input-error');
                setTimeout(() => {
                    inputElement.classList.remove('input-error');
                }, 400);
                
                // Clear the input and refocus for better UX
                setTimeout(() => {
                    inputElement.value = '';
                    inputElement.focus();
                }, 300);
            }
            
            // Message slide in animation
            if (messageDiv) {
                messageDiv.classList.add('message-slide-in');
                setTimeout(() => {
                    messageDiv.classList.remove('message-slide-in');
                }, 500);
            }
        }
    }
    
    // Function to mark puzzle as completed and advance
    function completePuzzle(puzzleNum) {
        // Mark as completed if not already
        if (!puzzleProgress.completed.includes(puzzleNum)) {
            puzzleProgress.completed.push(puzzleNum);
        }
        
        // Advance to next puzzle if not at the end
        if (puzzleNum < 4) {
            puzzleProgress.currentPuzzle = puzzleNum + 1;
        }
        
        // Save progress
        localStorage.setItem('seattlePuzzleProgress', JSON.stringify(puzzleProgress));
        
        // Update display
        updateProgressDisplay();
    }
    
    // Function to set up change name button
    function setupChangeNameButton() {
        const changeNameBtn = document.getElementById('change-name-btn');
        if (changeNameBtn) {
            changeNameBtn.addEventListener('click', function() {
                // Confirm before clearing progress
                const hasProgress = puzzleProgress.completed.length > 0;
                let shouldClear = true;
                
                if (hasProgress) {
                    shouldClear = confirm(`This will clear your progress (${puzzleProgress.completed.length}/4 puzzles completed). Are you sure?`);
                }
                
                if (shouldClear) {
                    // Clear stored name and progress
                    localStorage.removeItem('seattlePuzzlePlayerName');
                    localStorage.removeItem('seattlePuzzleProgress');
                    
                    // Track name change
                    if (typeof window.trackPuzzleEvent === 'function') {
                        window.trackPuzzleEvent({
                            eventType: 'name_change_requested',
                            playerName: playerName,
                            category: 'user_interaction',
                            progressCleared: hasProgress,
                            completedPuzzles: puzzleProgress.completed.length
                        });
                    }
                    
                    // Reload page to show name input again
                    window.location.reload();
                }
            });
        }
    }
    
    // Function to update puzzle greeting with player name
    function updatePuzzleGreeting() {
        const puzzle1Header = document.querySelector('#puzzle1 .glass-title');
        const welcomeMessage = document.getElementById('welcome-message');
        if (puzzle1Header && playerName) {
            puzzle1Header.textContent = `Puzzle 1 - Welcome, ${playerName}!`;
            if (welcomeMessage) {
                welcomeMessage.innerHTML = `Ready for your Seattle adventure?<br><small style="opacity: 0.7;">Good luck solving the puzzles!</small>`;
            }
        }
    }
    
    // Anti-debugging techniques
    (function() {
        // Disable F12, Ctrl+Shift+I, Ctrl+U
        document.addEventListener('keydown', function(e) {
            if (e.key === 'F12' || 
                (e.ctrlKey && e.shiftKey && e.key === 'I') ||
                (e.ctrlKey && e.key === 'u')) {
                e.preventDefault();
                console.log('%cNice try! 😉', 'color: blue; font-size: 16px;');
                return false;
            }
        });

        // Comprehensive right-click and context menu blocking
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            e.stopPropagation();
            console.log('%cRight-click disabled! 🚫', 'color: orange; font-size: 14px;');
            return false;
        }, true);
        
        // Block right-click on all elements
        document.addEventListener('mousedown', function(e) {
            if (e.button === 2) { // Right mouse button
                e.preventDefault();
                e.stopPropagation();
                return false;
            }
        }, true);
        
        // Block context menu on images and other elements
        document.addEventListener('dragstart', function(e) {
            e.preventDefault();
            return false;
        });
        
        // Block text selection to prevent easy copying
        document.addEventListener('selectstart', function(e) {
            if (e.target.tagName !== 'INPUT' && e.target.tagName !== 'TEXTAREA') {
                e.preventDefault();
                return false;
            }
        });

        // Console warning
        console.log('%cStop!', 'color: red; font-size: 50px; font-weight: bold;');
        console.log('%cThis is a puzzle game. Cheating ruins the fun!', 'color: red; font-size: 20px;');
        
        // Enhanced dev tools detection with answer scrambling
        let devtools = {open: false, orientation: null};
        setInterval(() => {
            const threshold = 160;
            if (window.outerHeight - window.innerHeight > threshold || 
                window.outerWidth - window.innerWidth > threshold) {
                if (!devtools.open) {
                    devtools.open = true;
                    console.clear();
                    console.log('%cPuzzle integrity protected! 🔒', 'color: red; font-size: 20px;');
                    // Scramble answers if devtools detected
                    window._0x4f2a = Array(10).fill(0).map(() => Math.floor(Math.random() * 255));
                    window._0x7b3c = Array(6).fill(0).map(() => Math.floor(Math.random() * 255));
                    window._0x9d4e = Array(4).fill(0).map(() => Math.floor(Math.random() * 255));
                    window._0x7f8g = Array(7).fill(0).map(() => Math.floor(Math.random() * 255));
                }
            } else {
                devtools.open = false;
            }
        }, 500);
    })();

    // Polynomial hash-based validation system
    const _0xPrime = 31; // Prime number for hash function
    const _0xMod = 1000000007; // Large prime modulus
    
    // Pre-computed polynomial hashes of answers
    const _0x4f2a = 0x28A0C550; // Hash of "thespheres"
    const _0x7b3c = 0x740505; // Hash of "bronze"  
    const _0x9d4e = 0x194AFE; // Hash of "2006"
    const _0x7f8g = 0xA2B738B; // Hash of "dreamer"
    
    // Decoy hashes to confuse reverse engineering
    const _0x1a2b = 0x9B4C7E2F;
    const _0x3c4d = 0x5A8D1F6C;
    const _0x5e6f = 0x7E2A9C4B;
    const _0x8h9i = 0x3F7B5D8E;
    
    function _0x2e1f(expectedHash, input) {
        try {
            // Compute polynomial hash of input
            const cleanInput = input.toLowerCase().replace(/\s/g, '');
            let hash = 0;
            let pow = 1;
            
            for (let i = 0; i < cleanInput.length; i++) {
                hash = (hash + (cleanInput.charCodeAt(i) * pow) % _0xMod) % _0xMod;
                pow = (pow * _0xPrime) % _0xMod;
            }
            
            // Add salt based on input length and first character
            const salt = (cleanInput.length * 17 + cleanInput.charCodeAt(0) * 23) % _0xMod;
            hash = (hash + salt) % _0xMod;
            
            return hash === expectedHash;
        } catch(e) {
            return false;
        }
    }
    
    // Decoy validation function
    function _0x9j0k(hash, input) {
        return Math.random() > 0.5; // Always returns random result
    }
    
    // Glass transition function
    function transitionToNextPuzzle(currentPuzzleId, nextPuzzleId) {
        const currentPuzzleDiv = document.getElementById(currentPuzzleId);
        const nextPuzzleDiv = document.getElementById(nextPuzzleId);
        
        // Add glass glow effect to current puzzle
        currentPuzzleDiv.classList.add('glass-glow');
        
        // Fade out current puzzle
        setTimeout(() => {
            currentPuzzleDiv.classList.add('fade-out');
        }, 600);
        
        // Show and fade in next puzzle
        setTimeout(() => {
            currentPuzzleDiv.style.display = 'none';
            nextPuzzleDiv.style.display = 'block';
            nextPuzzleDiv.classList.add('fade-in');
            nextPuzzleDiv.style.opacity = '1';
            // Update current puzzle number
            if (nextPuzzleId === 'puzzle1') currentPuzzle = 1;
            else if (nextPuzzleId === 'puzzle2') currentPuzzle = 2;
            else if (nextPuzzleId === 'puzzle3') currentPuzzle = 3;
            else if (nextPuzzleId === 'puzzle4') currentPuzzle = 4;
        }, 900);
    }
    
    // Puzzle 1 handler
    document.getElementById('puzzle1-form').addEventListener('submit', function(e) {
        e.preventDefault();
        const input = this.querySelector('input');
        const button = this.querySelector('button');
        const rawAnswer = input.value.trim();
        const answer = rawAnswer.toLowerCase().replace(/\s/g, '');
        const messageDiv = document.getElementById('puzzle1-message');
        const isCorrect = _0x2e1f(_0x4f2a, answer);
        
        // Add visual feedback immediately
        addInteractionFeedback(isCorrect, 1, input, button, messageDiv);
        
        // Track puzzle attempt with Firebase
        if (typeof window.trackPuzzleEvent === 'function') {
            window.trackPuzzleEvent({
                eventType: 'puzzle_attempt',
                playerName: playerName,
                puzzleNumber: 1,
                answer: rawAnswer,
                isCorrect: isCorrect,
                category: 'puzzle_interaction',
                timeSpent: Date.now() - (window.puzzle1StartTime || Date.now())
            });
        }
        
        if (isCorrect) {
            messageDiv.className = 'glass-message positive success-message';
            messageDiv.textContent = `Excellent work, ${playerName}! 🔑 You solved the first puzzle!`;
            messageDiv.style.display = 'block';
            
            // Mark puzzle as completed
            completePuzzle(1);
            
            // Track success
            if (typeof window.trackPuzzleEvent === 'function') {
                window.trackPuzzleEvent({
                    eventType: 'puzzle_solved',
                    playerName: playerName,
                    puzzleNumber: 1,
                    category: 'puzzle_success'
                });
            }
            
            // Transition to puzzle 2 with glass effects
            setTimeout(() => {
                navigateToPuzzle(2);
                window.puzzle2StartTime = Date.now();
            }, 1200);
        } else {
            messageDiv.className = 'glass-message negative';
            messageDiv.textContent = 'Incorrect. Try again, you\'ve got this!';
            messageDiv.style.display = 'block';
        }
    });

    // Puzzle 2 handler
    document.getElementById('puzzle2-form').addEventListener('submit', function(e) {
        e.preventDefault();
        const input = this.querySelector('input');
        const button = this.querySelector('button');
        const rawAnswer = input.value.trim();
        const answer = rawAnswer.toLowerCase().replace(/\s/g, '');
        const messageDiv = document.getElementById('puzzle2-message');
        const isCorrect = _0x2e1f(_0x7b3c, answer);
        
        // Add visual feedback immediately
        addInteractionFeedback(isCorrect, 2, input, button, messageDiv);
        
        // Track puzzle attempt with Firebase
        if (typeof window.trackPuzzleEvent === 'function') {
            window.trackPuzzleEvent({
                eventType: 'puzzle_attempt',
                playerName: playerName,
                puzzleNumber: 2,
                answer: rawAnswer,
                isCorrect: isCorrect,
                category: 'puzzle_interaction',
                timeSpent: Date.now() - (window.puzzle2StartTime || Date.now())
            });
        }
        
        if (isCorrect) {
            messageDiv.className = 'glass-message positive success-message';
            messageDiv.textContent = `Outstanding, ${playerName}! 🗼 You solved the second puzzle!`;
            messageDiv.style.display = 'block';
            
            // Mark puzzle as completed
            completePuzzle(2);
            
            // Track success
            if (typeof window.trackPuzzleEvent === 'function') {
                window.trackPuzzleEvent({
                    eventType: 'puzzle_solved',
                    playerName: playerName,
                    puzzleNumber: 2,
                    category: 'puzzle_success'
                });
            }
            
            // Transition to puzzle 3 with glass effects
            setTimeout(() => {
                navigateToPuzzle(3);
                window.puzzle3StartTime = Date.now();
            }, 1200);
        } else {
            messageDiv.className = 'glass-message negative';
            messageDiv.textContent = 'Incorrect. Keep trying, you\'re doing great!';
            messageDiv.style.display = 'block';
        }
    });

    // Puzzle 3 handler
    document.getElementById('puzzle3-form').addEventListener('submit', function(e) {
        e.preventDefault();
        const input = this.querySelector('input');
        const button = this.querySelector('button');
        const rawAnswer = input.value.trim();
        const answer = rawAnswer.toLowerCase().replace(/\s/g, '');
        const messageDiv = document.getElementById('puzzle3-message');
        const isCorrect = _0x2e1f(_0x9d4e, answer);
        
        // Add visual feedback immediately
        addInteractionFeedback(isCorrect, 3, input, button, messageDiv);
        
        // Track puzzle attempt with Firebase
        if (typeof window.trackPuzzleEvent === 'function') {
            window.trackPuzzleEvent({
                eventType: 'puzzle_attempt',
                playerName: playerName,
                puzzleNumber: 3,
                answer: rawAnswer,
                isCorrect: isCorrect,
                category: 'puzzle_interaction',
                timeSpent: Date.now() - (window.puzzle3StartTime || Date.now())
            });
        }
        
        if (isCorrect) {
            messageDiv.className = 'glass-message positive success-message';
            messageDiv.textContent = `Excellent, ${playerName}! 🎯 You solved the third puzzle!`;
            messageDiv.style.display = 'block';
            
            // Mark puzzle as completed
            completePuzzle(3);
            
            // Track success
            if (typeof window.trackPuzzleEvent === 'function') {
                window.trackPuzzleEvent({
                    eventType: 'puzzle_solved',
                    playerName: playerName,
                    puzzleNumber: 3,
                    category: 'puzzle_success'
                });
            }
            
            // Transition to puzzle 4 with glass effects
            setTimeout(() => {
                navigateToPuzzle(4);
                window.puzzle4StartTime = Date.now();
            }, 1200);
        } else {
            messageDiv.className = 'glass-message negative';
            messageDiv.textContent = 'Incorrect. You\'re getting closer to the final challenge!';
            messageDiv.style.display = 'block';
        }
    });

    // Puzzle 4 handler (Final puzzle)
    document.getElementById('puzzle4-form').addEventListener('submit', function(e) {
        e.preventDefault();
        const input = this.querySelector('input');
        const button = this.querySelector('button');
        const rawAnswer = input.value.trim();
        const answer = rawAnswer.toLowerCase().replace(/\s/g, '');
        const messageDiv = document.getElementById('puzzle4-message');
        const isCorrect = _0x2e1f(_0x7f8g, answer);
        
        // Add visual feedback immediately
        addInteractionFeedback(isCorrect, 4, input, button, messageDiv);
        
        // Track puzzle attempt with Firebase
        if (typeof window.trackPuzzleEvent === 'function') {
            window.trackPuzzleEvent({
                eventType: 'puzzle_attempt',
                playerName: playerName,
                puzzleNumber: 4,
                answer: rawAnswer,
                isCorrect: isCorrect,
                category: 'puzzle_interaction',
                timeSpent: Date.now() - (window.puzzle4StartTime || Date.now())
            });
        }
        
        if (isCorrect) {
            messageDiv.className = 'glass-message positive success-message';
            messageDiv.textContent = `Congratulations, ${playerName}! 🌟 You solved all four puzzles! You're a true Seattle puzzle master!`;
            messageDiv.style.display = 'block';
            
            // Mark final puzzle as completed
            completePuzzle(4);
            
            // Track success and completion
            if (typeof window.trackPuzzleEvent === 'function') {
                window.trackPuzzleEvent({
                    eventType: 'puzzle_solved',
                    playerName: playerName,
                    puzzleNumber: 4,
                    category: 'puzzle_success'
                });
                
                window.trackPuzzleEvent({
                    eventType: 'game_completed',
                    playerName: playerName,
                    category: 'game_completion',
                    totalTime: Date.now() - (window.gameStartTime || Date.now())
                });
            }
            
            // Add final glass celebration effect
            setTimeout(() => {
                document.getElementById('puzzle4').classList.add('glass-glow');
            }, 1000);
        } else {
            messageDiv.className = 'glass-message negative';
            messageDiv.textContent = 'Incorrect. You\'re so close to completing the final challenge!';
            messageDiv.style.display = 'block';
        }
    });
    </script>


</body>
</html>
