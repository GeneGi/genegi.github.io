<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Seattle Puzzles - A beautiful puzzle game featuring Chinese poetry riddles about Seattle landmarks">
    
    <!-- Firebase SDK -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
      import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js";
      
      // Your web app's Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyDHyayHDdBCdtGOrWhUq6QHk4iPS2QJDnc",
        authDomain: "seattlepuzzle-fcd89.firebaseapp.com",
        projectId: "seattlepuzzle-fcd89",
        storageBucket: "seattlepuzzle-fcd89.firebasestorage.app",
        messagingSenderId: "791934150017",
        appId: "1:791934150017:web:58827f896c2b453bb67480",
        measurementId: "G-9BQ7KQMDN0"
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      
      // Generate session ID
      const sessionId = 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
      
      // Make Firebase functions globally available
      window.trackPuzzleEvent = async function(eventData) {
        try {
          await addDoc(collection(db, "puzzle_events"), {
            ...eventData,
            sessionId: sessionId,
            timestamp: serverTimestamp(),
            userAgent: navigator.userAgent,
            screenSize: `${screen.width}x${screen.height}`,
            url: window.location.href
          });
          console.log('Event tracked successfully');
        } catch (error) {
          console.error('Error tracking event:', error);
          // Fallback to console log if Firebase fails
          console.log('Fallback tracking:', eventData);
        }
      };
      
      // Feedback submission function
      window.submitFeedback = async function(feedbackData) {
        try {
          await addDoc(collection(db, "puzzle_feedback"), {
            ...feedbackData,
            sessionId: sessionId,
            timestamp: serverTimestamp(),
            userAgent: navigator.userAgent,
            screenSize: `${screen.width}x${screen.height}`,
            url: window.location.href
          });
          console.log('Feedback submitted successfully');
          return { success: true };
        } catch (error) {
          console.error('Error submitting feedback:', error);
          return { success: false, error: error.message };
        }
      };
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>{{ .Title }} - {{ .Site.Title }}</title>
    <meta name="description" content="{{ .Description }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Apple Glass Design */
        /* iOS Safari specific fixes */
        @media (max-width: 768px) {
            /* Fix iOS Safari viewport issues */
            body {
                -webkit-text-size-adjust: 100%;
                -ms-text-size-adjust: 100%;
            }
            
            /* Fix iOS Safari input zoom */
            input, textarea, select {
                font-size: 16px !important;
                transform: translateZ(0);
                -webkit-appearance: none;
                border-radius: 0;
            }
            
            /* Fix iOS Safari button styling */
            button {
                -webkit-appearance: none;
                border-radius: 0;
                cursor: pointer;
            }
            
            /* Prevent iOS Safari from adding blue highlight */
            * {
                -webkit-tap-highlight-color: transparent;
                -webkit-touch-callout: none;
            }
            
            /* Fix iOS Safari backdrop-filter performance */
            .glass-container {
                transform: translateZ(0);
                -webkit-transform: translateZ(0);
                will-change: transform;
            }
            
            /* Improve scrolling on iOS */
            body {
                -webkit-overflow-scrolling: touch;
                overflow-scrolling: touch;
            }
        }

        /* Mobile Material Design - Enhanced for Material 3 */
        @media (max-width: 768px) {
            body {
                padding: 0;
                font-size: 16px;
                line-height: 1.5;
                /* Material Design background */
                background: linear-gradient(135deg, #6750a4 0%, #7c4dff 100%) !important;
                background-attachment: fixed !important;
                background-repeat: no-repeat !important;
                background-size: cover !important;
                min-height: 100vh !important;
                min-height: 100dvh !important;
                font-family: 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif !important;
            }
            
            /* Container improvements */
            .container {
                padding: 0 16px !important;
                max-width: 100% !important;
            }
            
            /* Material Design Cards */
            .glass-container {
                margin: 16px !important;
                padding: 24px !important;
                max-width: calc(100% - 32px) !important;
                min-height: auto !important;
                /* Material Design elevation 2 */
                background: #ffffff !important;
                backdrop-filter: none !important;
                -webkit-backdrop-filter: none !important;
                border: none !important;
                border-radius: 12px !important;
                box-shadow: 
                    0 2px 4px rgba(0, 0, 0, 0.14),
                    0 3px 4px rgba(0, 0, 0, 0.12),
                    0 1px 5px rgba(0, 0, 0, 0.20) !important;
                color: #1c1b1f !important;
                transition: box-shadow 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
            }
            
            /* Header styling - Material Design */
            .glass-header {
                font-size: 2rem !important;
                font-weight: 500 !important;
                color: white !important;
                text-align: center !important;
                margin: 24px 16px 32px 16px !important;
                text-shadow: none !important;
                letter-spacing: 0 !important;
                font-family: 'Roboto', sans-serif !important;
            }
            
            /* Material Design Player Info Card */
            #player-info-bar {
                padding: 24px !important;
                margin: 16px !important;
                border-radius: 12px !important;
                background: #ffffff !important;
                /* Material elevation 1 */
                box-shadow: 
                    0 1px 3px rgba(0, 0, 0, 0.12),
                    0 1px 2px rgba(0, 0, 0, 0.24) !important;
                border: none !important;
            }
            
            /* Material Typography */
            #player-name-display {
                font-size: 1.125rem !important;
                color: #1c1b1f !important;
                font-weight: 500 !important;
                letter-spacing: 0.15px !important;
                font-family: 'Roboto', sans-serif !important;
            }
            
            /* Material Progress Bar */
            #progress-text {
                font-size: 0.875rem !important;
                font-weight: 500 !important;
                color: #49454f !important;
                letter-spacing: 0.25px !important;
            }
            
            #progress-bar {
                height: 4px !important;
                border-radius: 2px !important;
                background: #6750a4 !important;
                box-shadow: none !important;
            }
            
            /* Progress bar track */
            #progress-bar::before {
                content: '' !important;
                position: absolute !important;
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                bottom: 0 !important;
                background: #e7e0ec !important;
                border-radius: 2px !important;
                z-index: -1 !important;
            }
            
            /* Material Design Navigation */
            #puzzle-nav {
                display: grid !important;
                grid-template-columns: 1fr 1fr !important;
                gap: 12px !important;
                margin-top: 20px !important;
            }
            
            .puzzle-nav-btn {
                padding: 16px 12px !important;
                font-size: 0.875rem !important;
                min-height: 48px !important;
                border-radius: 12px !important;
                background: #f7f2fa !important;
                color: #1c1b1f !important;
                border: 1px solid #79747e !important;
                font-weight: 500 !important;
                text-align: center !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                line-height: 1.4 !important;
                transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1) !important;
                box-shadow: none !important;
                font-family: 'Roboto', sans-serif !important;
                letter-spacing: 0.1px !important;
            }
            
            .puzzle-nav-btn:hover {
                background: #ece6f0 !important;
                box-shadow: 
                    0 1px 3px rgba(0, 0, 0, 0.12),
                    0 1px 2px rgba(0, 0, 0, 0.24) !important;
            }
            
            .puzzle-nav-btn:active {
                background: #e8def8 !important;
                transform: none !important;
            }
            
            /* Material Design Change Name Button */
            #change-name-btn {
                font-size: 0.875rem !important;
                padding: 10px 24px !important;
                background: #6750a4 !important;
                color: white !important;
                -webkit-text-fill-color: white !important;
                border: none !important;
                font-weight: 500 !important;
                min-height: 40px !important;
                border-radius: 20px !important;
                backdrop-filter: none !important;
                -webkit-backdrop-filter: none !important;
                text-shadow: none !important;
                box-shadow: 
                    0 1px 3px rgba(0, 0, 0, 0.12),
                    0 1px 2px rgba(0, 0, 0, 0.24) !important;
                transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1) !important;
                font-family: 'Roboto', sans-serif !important;
                letter-spacing: 0.1px !important;
                text-transform: uppercase !important;
            }
            
            #change-name-btn:hover {
                background: #7c4dff !important;
                box-shadow: 
                    0 3px 6px rgba(0, 0, 0, 0.16),
                    0 3px 6px rgba(0, 0, 0, 0.23) !important;
            }
            
            #change-name-btn:active {
                background: #5a3d99 !important;
                box-shadow: 
                    0 1px 3px rgba(0, 0, 0, 0.12),
                    0 1px 2px rgba(0, 0, 0, 0.24) !important;
            }
            
            /* Material Design Puzzle Containers */
            .puzzle-container {
                padding: 24px !important;
                border-radius: 12px !important;
                /* Material elevation 2 */
                box-shadow: 
                    0 2px 4px rgba(0, 0, 0, 0.14),
                    0 3px 4px rgba(0, 0, 0, 0.12),
                    0 1px 5px rgba(0, 0, 0, 0.20) !important;
            }
            
            .puzzle-spacing {
                margin-bottom: 16px !important;
            }
            
            /* Material Design Typography */
            .glass-title {
                font-size: 1.5rem !important;
                margin-bottom: 16px !important;
                line-height: 1.33 !important;
                color: #1c1b1f !important;
                font-weight: 400 !important;
                letter-spacing: 0 !important;
                font-family: 'Roboto', sans-serif !important;
            }
            
            .glass-subtitle {
                font-size: 1rem !important;
                line-height: 1.5 !important;
                margin-bottom: 24px !important;
                padding: 0 !important;
                color: #49454f !important;
                font-weight: 400 !important;
                letter-spacing: 0.15px !important;
                font-family: 'Roboto', sans-serif !important;
            }
            
            /* Material Design Input Fields */
            .glass-input {
                margin: 24px 0 !important;
            }
            
            .glass-input input {
                font-size: 16px !important;
                padding: 16px !important;
                border-radius: 4px !important;
                width: 100% !important;
                box-sizing: border-box !important;
                background: #ffffff !important;
                border: 1px solid #79747e !important;
                color: #1c1b1f !important;
                -webkit-text-fill-color: #1c1b1f !important;
                font-weight: 400 !important;
                transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1) !important;
                box-shadow: none !important;
                font-family: 'Roboto', sans-serif !important;
                letter-spacing: 0.15px !important;
            }
            
            .glass-input input:focus {
                border-color: #6750a4 !important;
                border-width: 2px !important;
                outline: none !important;
                box-shadow: none !important;
            }
            
            .glass-input input::placeholder {
                color: #79747e !important;
                opacity: 1 !important;
                -webkit-text-fill-color: #79747e !important;
                font-weight: 400 !important;
            }
            
            /* Material Design Buttons */
            .glass-button {
                font-size: 0.875rem !important;
                padding: 10px 24px !important;
                border-radius: 20px !important;
                margin-top: 16px !important;
                min-height: 40px !important;
                touch-action: manipulation !important;
                background: #6750a4 !important;
                color: white !important;
                -webkit-text-fill-color: white !important;
                border: none !important;
                box-shadow: 
                    0 1px 3px rgba(0, 0, 0, 0.12),
                    0 1px 2px rgba(0, 0, 0, 0.24) !important;
                font-weight: 500 !important;
                letter-spacing: 0.1px !important;
                transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1) !important;
                font-family: 'Roboto', sans-serif !important;
                text-transform: uppercase !important;
                text-shadow: none !important;
                backdrop-filter: none !important;
                -webkit-backdrop-filter: none !important;
                opacity: 1 !important;
            }
            
            /* Ensure all submit buttons are visible */
            .glass-button,
            button.glass-button,
            form .glass-button,
            input[type="submit"],
            button[type="submit"],
            #player-name-form .glass-button,
            #puzzle1-form .glass-button,
            #puzzle2-form .glass-button,
            #puzzle3-form .glass-button,
            #puzzle4-form .glass-button {
                background: #6750a4 !important;
                background-color: #6750a4 !important;
                color: white !important;
                -webkit-text-fill-color: white !important;
                border: none !important;
                font-weight: 500 !important;
                font-size: 0.875rem !important;
                padding: 10px 24px !important;
                border-radius: 20px !important;
                min-height: 40px !important;
                text-transform: uppercase !important;
                letter-spacing: 0.1px !important;
                font-family: 'Roboto', sans-serif !important;
                text-shadow: none !important;
                backdrop-filter: none !important;
                -webkit-backdrop-filter: none !important;
                opacity: 1 !important;
                box-shadow: 
                    0 1px 3px rgba(0, 0, 0, 0.12),
                    0 1px 2px rgba(0, 0, 0, 0.24) !important;
            }
            
            .glass-button:hover,
            button.glass-button:hover,
            form .glass-button:hover {
                background: #7c4dff !important;
                background-color: #7c4dff !important;
                color: white !important;
                -webkit-text-fill-color: white !important;
                box-shadow: 
                    0 3px 6px rgba(0, 0, 0, 0.16),
                    0 3px 6px rgba(0, 0, 0, 0.23) !important;
            }
            
            .glass-button:active,
            button.glass-button:active,
            form .glass-button:active {
                background: #5a3d99 !important;
                background-color: #5a3d99 !important;
                color: white !important;
                -webkit-text-fill-color: white !important;
                box-shadow: 
                    0 1px 3px rgba(0, 0, 0, 0.12),
                    0 1px 2px rgba(0, 0, 0, 0.24) !important;
            }
            
            /* Material Design Messages */
            .glass-message {
                font-size: 0.875rem !important;
                padding: 16px 24px !important;
                border-radius: 4px !important;
                margin: 16px 0 !important;
                text-align: left !important;
                font-weight: 400 !important;
                line-height: 1.43 !important;
                box-shadow: none !important;
                border: none !important;
                font-family: 'Roboto', sans-serif !important;
                letter-spacing: 0.25px !important;
                display: none !important; /* Hidden by default */
            }
            
            /* Show message when display is set to block */
            .glass-message[style*="display: block"],
            .glass-message[style*="display:block"] {
                display: block !important;
            }
            
            /* Material Success - Green */
            .glass-message.positive,
            .glass-message.success-message {
                background: #e8f5e8 !important;
                color: #1b5e20 !important;
                -webkit-text-fill-color: #1b5e20 !important;
                border-left: 4px solid #4caf50 !important;
            }
            
            /* Material Error - Red */
            .glass-message.negative {
                background: #ffebee !important;
                color: #c62828 !important;
                -webkit-text-fill-color: #c62828 !important;
                border-left: 4px solid #f44336 !important;
            }
            
            /* Material Icons */
            .glass-message.positive::before {
                content: "✓ " !important;
                font-size: 16px !important;
                margin-right: 8px !important;
                font-weight: 500 !important;
            }
            
            .glass-message.negative::before {
                content: "⚠ " !important;
                font-size: 16px !important;
                margin-right: 8px !important;
                font-weight: 500 !important;
            }
            
            /* Material Design Credits Card */
            #credits-card {
                padding: 24px !important;
                margin: 16px !important;
                max-width: calc(100% - 32px) !important;
                background: #ffffff !important;
                backdrop-filter: none !important;
                -webkit-backdrop-filter: none !important;
                border: none !important;
                border-radius: 12px !important;
                /* Material elevation 3 */
                box-shadow: 
                    0 3px 6px rgba(0, 0, 0, 0.16),
                    0 3px 6px rgba(0, 0, 0, 0.23) !important;
            }
            
            #credits-card .glass-title {
                font-size: 1.5rem !important;
                color: #1c1b1f !important;
                margin-bottom: 8px !important;
                font-weight: 500 !important;
                letter-spacing: 0 !important;
                text-align: center !important;
            }
            
            #credits-card .glass-subtitle {
                font-size: 1rem !important;
                color: #49454f !important;
                line-height: 1.5 !important;
                font-weight: 400 !important;
                margin-bottom: 24px !important;
                text-align: center !important;
                letter-spacing: 0.15px !important;
            }
            
            #credits-card .glass-subtitle span {
                color: #1c1b1f !important;
                font-weight: 500 !important;
            }
            
            #credits-card h3 {
                color: #1c1b1f !important;
                font-size: 1.125rem !important;
                font-weight: 500 !important;
                margin-bottom: 16px !important;
                letter-spacing: 0.15px !important;
                text-align: center !important;
            }
            
            #credits-card p {
                color: #49454f !important;
                font-size: 0.875rem !important;
                margin-bottom: 12px !important;
                font-weight: 400 !important;
                line-height: 1.43 !important;
                letter-spacing: 0.25px !important;
                text-align: left !important;
                padding: 0 8px !important;
            }
            
            #credits-card strong {
                color: #1c1b1f !important;
                font-weight: 500 !important;
                display: block !important;
                margin-bottom: 4px !important;
            }
            
            #credits-card em {
                color: #79747e !important;
                font-style: italic !important;
                font-weight: 400 !important;
                font-size: 0.8125rem !important;
            }
            
            #credits-card a {
                color: #6750a4 !important;
                text-decoration: none !important;
                font-weight: 500 !important;
                border-bottom: 1px solid transparent !important;
                transition: border-bottom-color 0.2s ease !important;
            }
            
            #credits-card a:hover,
            #credits-card a:focus {
                border-bottom-color: #6750a4 !important;
            }
            
            /* Credits inner section - Material Card */
            #credits-card div[style*="background: rgba(255, 255, 255, 0.1)"] {
                background: #f7f2fa !important;
                border: 1px solid #e7e0ec !important;
                border-radius: 8px !important;
                backdrop-filter: none !important;
                -webkit-backdrop-filter: none !important;
                padding: 20px !important;
                margin: 16px 0 !important;
            }
            
            /* Material Design Play Again Button */
            #restart-game-btn {
                background: #6750a4 !important;
                background-color: #6750a4 !important;
                color: white !important;
                -webkit-text-fill-color: white !important;
                border: none !important;
                font-weight: 500 !important;
                padding: 12px 32px !important;
                font-size: 0.875rem !important;
                border-radius: 20px !important;
                backdrop-filter: none !important;
                -webkit-backdrop-filter: none !important;
                text-shadow: none !important;
                min-height: 48px !important;
                box-shadow: 
                    0 2px 4px rgba(0, 0, 0, 0.14),
                    0 3px 4px rgba(0, 0, 0, 0.12),
                    0 1px 5px rgba(0, 0, 0, 0.20) !important;
                transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1) !important;
                font-family: 'Roboto', sans-serif !important;
                letter-spacing: 0.1px !important;
                text-transform: uppercase !important;
                cursor: pointer !important;
                opacity: 1 !important;
                margin-top: 8px !important;
            }
            
            #restart-game-btn:hover {
                background: #7c4dff !important;
                background-color: #7c4dff !important;
                color: white !important;
                -webkit-text-fill-color: white !important;
                box-shadow: 
                    0 3px 6px rgba(0, 0, 0, 0.16),
                    0 3px 6px rgba(0, 0, 0, 0.23) !important;
            }
            
            #restart-game-btn:active {
                background: #5a3d99 !important;
                background-color: #5a3d99 !important;
                color: white !important;
                -webkit-text-fill-color: white !important;
                box-shadow: 
                    0 1px 3px rgba(0, 0, 0, 0.12),
                    0 1px 2px rgba(0, 0, 0, 0.24) !important;
            }
            
            /* Material Design Feedback Form */
            #feedback-form textarea {
                font-size: 16px !important;
                padding: 12px !important;
                border: 1px solid #79747e !important;
                border-radius: 4px !important;
                width: 100% !important;
                box-sizing: border-box !important;
                background: #ffffff !important;
                color: #1c1b1f !important;
                -webkit-text-fill-color: #1c1b1f !important;
                font-family: 'Roboto', sans-serif !important;
                resize: vertical !important;
                min-height: 80px !important;
                transition: border-color 0.2s ease !important;
            }
            
            #feedback-form textarea:focus {
                border-color: #6750a4 !important;
                border-width: 2px !important;
                outline: none !important;
            }
            
            #feedback-form textarea::placeholder {
                color: #79747e !important;
                opacity: 1 !important;
                -webkit-text-fill-color: #79747e !important;
            }
            
            #feedback-submit-btn {
                background: #6750a4 !important;
                background-color: #6750a4 !important;
                color: white !important;
                -webkit-text-fill-color: white !important;
                border: none !important;
                font-weight: 500 !important;
                padding: 12px 24px !important;
                font-size: 0.875rem !important;
                border-radius: 20px !important;
                min-height: 48px !important;
                width: 100% !important;
                cursor: pointer !important;
                transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1) !important;
                font-family: 'Roboto', sans-serif !important;
                letter-spacing: 0.1px !important;
                text-transform: uppercase !important;
                text-shadow: none !important;
                backdrop-filter: none !important;
                -webkit-backdrop-filter: none !important;
                opacity: 1 !important;
                box-shadow: 
                    0 1px 3px rgba(0, 0, 0, 0.12),
                    0 1px 2px rgba(0, 0, 0, 0.24) !important;
            }
            
            #feedback-submit-btn:hover {
                background: #7c4dff !important;
                background-color: #7c4dff !important;
                color: white !important;
                -webkit-text-fill-color: white !important;
                box-shadow: 
                    0 3px 6px rgba(0, 0, 0, 0.16),
                    0 3px 6px rgba(0, 0, 0, 0.23) !important;
            }
            
            #feedback-submit-btn:active {
                background: #5a3d99 !important;
                background-color: #5a3d99 !important;
                color: white !important;
                -webkit-text-fill-color: white !important;
                box-shadow: 
                    0 1px 3px rgba(0, 0, 0, 0.12),
                    0 1px 2px rgba(0, 0, 0, 0.24) !important;
            }
            
            #feedback-submit-btn:disabled {
                background: #79747e !important;
                background-color: #79747e !important;
                color: #ffffff !important;
                -webkit-text-fill-color: #ffffff !important;
                cursor: not-allowed !important;
                opacity: 0.6 !important;
            }
            
            /* Star rating styling */
            .star {
                font-size: 24px !important;
                color: #e7e0ec !important;
                cursor: pointer !important;
                transition: color 0.2s ease !important;
                user-select: none !important;
                -webkit-user-select: none !important;
                -webkit-tap-highlight-color: transparent !important;
                padding: 2px !important;
                display: inline-block !important;
            }
            
            .star:hover {
                color: #ffc107 !important;
                transform: scale(1.1) !important;
            }
            
            .star.selected {
                color: #ffc107 !important;
            }
            
            .star.active {
                color: #ffc107 !important;
            }
            
            /* Character counter styling */
            #char-count {
                font-size: 0.75rem !important;
                color: #79747e !important;
                font-family: 'Roboto', sans-serif !important;
            }
            
            /* Feedback labels */
            #feedback-form label {
                color: #1c1b1f !important;
                font-weight: 500 !important;
                font-size: 0.875rem !important;
                font-family: 'Roboto', sans-serif !important;
                letter-spacing: 0.25px !important;
            }
            
            /* Feedback Button in Player Info Bar */
            #feedback-btn {
                background: rgba(255, 255, 255, 0.15) !important;
                border: 1px solid rgba(255, 255, 255, 0.3) !important;
                color: rgba(255, 255, 255, 0.9) !important;
                -webkit-text-fill-color: rgba(255, 255, 255, 0.9) !important;
                font-size: 0.8rem !important;
                padding: 8px 16px !important;
                border-radius: 12px !important;
                min-height: 36px !important;
                font-weight: 500 !important;
                font-family: 'Roboto', sans-serif !important;
                cursor: pointer !important;
                transition: all 0.2s ease !important;
                backdrop-filter: none !important;
                -webkit-backdrop-filter: none !important;
                text-shadow: none !important;
            }
            
            #feedback-btn:hover {
                background: rgba(255, 255, 255, 0.25) !important;
                border-color: rgba(255, 255, 255, 0.4) !important;
                color: rgba(255, 255, 255, 1) !important;
                -webkit-text-fill-color: rgba(255, 255, 255, 1) !important;
            }
            
            /* Feedback Modal Mobile Styling */
            .feedback-modal {
                z-index: 1000 !important;
            }
            
            .feedback-modal-content {
                max-width: 90% !important;
                width: 90% !important;
                max-height: 85vh !important;
                padding: 20px !important;
                border-radius: 12px !important;
                background: #ffffff !important;
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3) !important;
            }
            
            /* Modal Header */
            #feedback-modal-close {
                background: none !important;
                border: none !important;
                font-size: 28px !important;
                color: #79747e !important;
                cursor: pointer !important;
                padding: 8px !important;
                border-radius: 50% !important;
                transition: background-color 0.2s !important;
                min-height: 44px !important;
                min-width: 44px !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
            }
            
            #feedback-modal-close:hover {
                background: rgba(121, 116, 126, 0.1) !important;
            }
            
            /* Modal Form Elements */
            #modal-feedback-text {
                font-size: 16px !important;
                padding: 12px !important;
                border: 1px solid #79747e !important;
                border-radius: 4px !important;
                width: 100% !important;
                box-sizing: border-box !important;
                background: #ffffff !important;
                color: #1c1b1f !important;
                -webkit-text-fill-color: #1c1b1f !important;
                font-family: 'Roboto', sans-serif !important;
                resize: vertical !important;
                min-height: 100px !important;
                transition: border-color 0.2s ease !important;
            }
            
            #modal-feedback-text:focus {
                border-color: #6750a4 !important;
                border-width: 2px !important;
                outline: none !important;
            }
            
            #modal-feedback-text::placeholder {
                color: #79747e !important;
                opacity: 1 !important;
                -webkit-text-fill-color: #79747e !important;
            }
            
            /* Modal Buttons */
            #modal-feedback-submit-btn,
            #modal-feedback-cancel,
            #modal-continue-btn {
                font-size: 0.875rem !important;
                padding: 12px 20px !important;
                border-radius: 20px !important;
                font-weight: 500 !important;
                cursor: pointer !important;
                transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1) !important;
                font-family: 'Roboto', sans-serif !important;
                text-transform: uppercase !important;
                letter-spacing: 0.1px !important;
                min-height: 48px !important;
                text-shadow: none !important;
                backdrop-filter: none !important;
                -webkit-backdrop-filter: none !important;
            }
            
            #modal-feedback-submit-btn,
            #modal-continue-btn {
                background: #6750a4 !important;
                background-color: #6750a4 !important;
                color: white !important;
                -webkit-text-fill-color: white !important;
                border: none !important;
            }
            
            #modal-feedback-submit-btn:hover,
            #modal-continue-btn:hover {
                background: #7c4dff !important;
                background-color: #7c4dff !important;
            }
            
            #modal-feedback-submit-btn:disabled {
                background: #79747e !important;
                background-color: #79747e !important;
                color: #ffffff !important;
                -webkit-text-fill-color: #ffffff !important;
                cursor: not-allowed !important;
                opacity: 0.6 !important;
            }
            
            #modal-feedback-cancel {
                background: transparent !important;
                color: #6750a4 !important;
                -webkit-text-fill-color: #6750a4 !important;
                border: 1px solid #6750a4 !important;
            }
            
            #modal-feedback-cancel:hover {
                background: rgba(103, 80, 164, 0.1) !important;
            }
            
            /* Modal Star Rating */
            .modal-star {
                font-size: 28px !important;
                color: #e7e0ec !important;
                cursor: pointer !important;
                transition: all 0.2s ease !important;
                user-select: none !important;
                -webkit-user-select: none !important;
                -webkit-tap-highlight-color: transparent !important;
                padding: 4px !important;
                display: inline-block !important;
                border-radius: 4px !important;
            }
            
            .modal-star:hover {
                color: #ffc107 !important;
                transform: scale(1.1) !important;
                background: rgba(255, 193, 7, 0.1) !important;
            }
            
            .modal-star.selected {
                color: #ffc107 !important;
                background: rgba(255, 193, 7, 0.1) !important;
            }
            
            .modal-star.active {
                color: #ffc107 !important;
            }
            
            /* Modal Labels */
            .feedback-modal-content label {
                color: #1c1b1f !important;
                font-weight: 500 !important;
                font-size: 0.875rem !important;
                font-family: 'Roboto', sans-serif !important;
                letter-spacing: 0.25px !important;
            }
            
            /* Modal Character Counter */
            #modal-char-count {
                font-size: 0.75rem !important;
                color: #79747e !important;
                font-family: 'Roboto', sans-serif !important;
            }
            
            /* Material Design Text Rendering */
            * {
                -webkit-font-smoothing: antialiased !important;
                -moz-osx-font-smoothing: grayscale !important;
                text-rendering: optimizeLegibility !important;
            }
        }
            
            /* CLEAR SUCCESS/FAILURE MESSAGES FOR MOBILE */
            .glass-message {
                font-size: 16px !important;
                padding: 20px !important;
                border-radius: 15px !important;
                margin: 20px 0 !important;
                text-align: center !important;
                font-weight: 600 !important;
                border: 3px solid !important;
                backdrop-filter: none !important;
                -webkit-backdrop-filter: none !important;
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3) !important;
            }
            
            /* SUCCESS MESSAGE - Green */
            .glass-message.positive,
            .glass-message.success-message {
                background: #34c759 !important;
                color: white !important;
                -webkit-text-fill-color: white !important;
                border-color: #30d158 !important;
                text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3) !important;
            }
            
            /* FAILURE MESSAGE - Red */
            .glass-message.negative {
                background: #ff453a !important;
                color: white !important;
                -webkit-text-fill-color: white !important;
                border-color: #ff6961 !important;
                text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3) !important;
            }
            
            /* Add icons and animations */
            .glass-message.positive::before {
                content: "✅ ";
                font-size: 20px;
                margin-right: 8px;
            }
            
            .glass-message.negative::before {
                content: "❌ ";
                font-size: 20px;
                margin-right: 8px;
            }
            
            /* MOBILE TEXT VISIBILITY OVERRIDES - HIGHEST PRIORITY */
            .glass-message,
            div.glass-message,
            #puzzle1-message,
            #puzzle2-message,
            #puzzle3-message,
            #puzzle4-message {
                font-size: 16px !important;
                padding: 20px !important;
                border-radius: 15px !important;
                margin: 20px 0 !important;
                text-align: center !important;
                font-weight: 700 !important;
                border: 3px solid !important;
                backdrop-filter: none !important;
                -webkit-backdrop-filter: none !important;
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3) !important;
                line-height: 1.4 !important;
                min-height: 60px !important;
                display: none !important; /* Hidden by default */
                align-items: center !important;
                justify-content: center !important;
                text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5) !important;
            }
            
            /* Show message when display is explicitly set to block */
            .glass-message[style*="display: block"],
            .glass-message[style*="display:block"],
            div.glass-message[style*="display: block"],
            div.glass-message[style*="display:block"],
            #puzzle1-message[style*="display: block"],
            #puzzle2-message[style*="display: block"],
            #puzzle3-message[style*="display: block"],
            #puzzle4-message[style*="display: block"] {
                display: flex !important;
            }
            
            /* SUCCESS - Bright Green */
            .glass-message.positive,
            .glass-message.success-message,
            div.glass-message.positive,
            div.glass-message.success-message {
                background: #34c759 !important;
                background-color: #34c759 !important;
                color: white !important;
                -webkit-text-fill-color: white !important;
                border-color: #30d158 !important;
            }
            
            /* ERROR - Bright Red */
            .glass-message.negative,
            div.glass-message.negative {
                background: #ff453a !important;
                background-color: #ff453a !important;
                color: white !important;
                -webkit-text-fill-color: white !important;
                border-color: #ff6961 !important;
            }
            
            /* CRITICAL: Fix Change Name button visibility on mobile */
            #change-name-btn,
            button#change-name-btn,
            .glass-container #change-name-btn,
            #player-info-bar #change-name-btn {
                background: #7877c6 !important;
                background-color: #7877c6 !important;
                color: #000000 !important;
                -webkit-text-fill-color: #000000 !important;
                text-shadow: none !important;
                backdrop-filter: none !important;
                -webkit-backdrop-filter: none !important;
                border: 2px solid #333333 !important;
                font-weight: 700 !important;
                opacity: 1 !important;
                font-size: 0.75rem !important;
                padding: 8px 12px !important;
                min-height: 36px !important;
                border-radius: 8px !important;
                text-decoration: none !important;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
            }
            
            #change-name-btn:hover,
            #change-name-btn:focus,
            #change-name-btn:active,
            button#change-name-btn:hover,
            button#change-name-btn:focus,
            button#change-name-btn:active {
                background: #6a69b5 !important;
                background-color: #6a69b5 !important;
                color: #000000 !important;
                -webkit-text-fill-color: #000000 !important;
                border: 2px solid #333333 !important;
            }
            
            /* Credits card mobile styling */
            #credits-card {
                padding: 20px !important;
                margin: 15px auto !important;
                max-width: 95% !important;
                background: rgba(255, 255, 255, 0.95) !important;
                backdrop-filter: none !important;
                -webkit-backdrop-filter: none !important;
                border: 1px solid rgba(0, 0, 0, 0.1) !important;
            }
            
            #credits-card .glass-title {
                font-size: 1.5rem !important;
                color: #333 !important;
                margin-bottom: 1rem !important;
                font-weight: 700 !important;
            }
            
            #credits-card .glass-subtitle {
                font-size: 0.9rem !important;
                color: #555 !important;
                line-height: 1.4 !important;
                font-weight: 600 !important;
            }
            
            #credits-card h3 {
                color: #333 !important;
                font-size: 1rem !important;
                font-weight: 700 !important;
            }
            
            #credits-card p {
                color: #444 !important;
                font-size: 0.85rem !important;
                margin-bottom: 0.8rem !important;
                font-weight: 500 !important;
                line-height: 1.5 !important;
            }
            
            #credits-card strong {
                color: #222 !important;
                font-weight: 700 !important;
            }
            
            #credits-card em {
                color: #666 !important;
                font-style: italic !important;
            }
            
            #credits-card a {
                color: #7877c6 !important;
                text-decoration: underline !important;
                font-weight: 600 !important;
            }
            
            #credits-card a:hover,
            #credits-card a:focus {
                color: #5a59a3 !important;
                text-decoration: underline !important;
            }
            
            /* Credits card inner section styling */
            #credits-card div[style*="background: rgba(255, 255, 255, 0.1)"] {
                background: rgba(240, 240, 240, 0.9) !important;
                border: 1px solid rgba(0, 0, 0, 0.1) !important;
                backdrop-filter: none !important;
                -webkit-backdrop-filter: none !important;
            }
            
            #restart-game-btn {
                background: #7877c6 !important;
                color: white !important;
                -webkit-text-fill-color: white !important;
                border: 2px solid #5a59a3 !important;
                font-weight: 600 !important;
                padding: 12px 24px !important;
                font-size: 0.9rem !important;
                border-radius: 12px !important;
                backdrop-filter: none !important;
                -webkit-backdrop-filter: none !important;
                text-shadow: none !important;
                min-height: 44px !important;
            }
            
            #restart-game-btn:hover,
            #restart-game-btn:focus,
            #restart-game-btn:active {
                background: #6a69b5 !important;
                color: white !important;
                -webkit-text-fill-color: white !important;
            }
            
            /* ENHANCED SUCCESS/ERROR MESSAGES FOR MOBILE */
            .glass-message {
                font-size: 16px !important;
                padding: 20px !important;
                border-radius: 15px !important;
                margin: 20px 0 !important;
                text-align: center !important;
                font-weight: 700 !important;
                border: 3px solid !important;
                backdrop-filter: none !important;
                -webkit-backdrop-filter: none !important;
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3) !important;
                line-height: 1.4 !important;
                min-height: 60px !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
            }
            
            /* SUCCESS MESSAGE - Bright Green with high contrast */
            .glass-message.positive,
            .glass-message.success-message {
                background: #34c759 !important;
                color: white !important;
                -webkit-text-fill-color: white !important;
                border-color: #30d158 !important;
                text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5) !important;
            }
            
            /* ERROR MESSAGE - Bright Red with high contrast */
            .glass-message.negative {
                background: #ff453a !important;
                color: white !important;
                -webkit-text-fill-color: white !important;
                border-color: #ff6961 !important;
                text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5) !important;
            }
            
            /* Enhanced icons for better visibility */
            .glass-message.positive::before {
                content: "✅ ";
                font-size: 24px !important;
                margin-right: 10px !important;
                filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3)) !important;
            }
            
            .glass-message.negative::before {
                content: "❌ ";
                font-size: 24px !important;
                margin-right: 10px !important;
                filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3)) !important;
            }
            
            /* Alternative high contrast version */
            @supports not (backdrop-filter: blur(10px)) {
                #change-name-btn {
                    background: #ffffff !important;
                    background-color: #ffffff !important;
                    color: #333333 !important;
                    -webkit-text-fill-color: #333333 !important;
                    border: 2px solid #7877c6 !important;
                }
            }
        }

        /* Security and anti-inspection styles */
        * {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* Allow text selection only in input fields */
        input, textarea {
            -webkit-user-select: text !important;
            -moz-user-select: text !important;
            -ms-user-select: text !important;
            user-select: text !important;
        }
        
        /* Prevent image dragging */
        img {
            -webkit-user-drag: none;
            -khtml-user-drag: none;
            -moz-user-drag: none;
            -o-user-drag: none;
            user-drag: none;
            pointer-events: none;
        }
        
        /* Hide scrollbars to make inspection harder */
        ::-webkit-scrollbar {
            width: 0px;
            background: transparent;
        }
        
        body {
            background: 
                linear-gradient(135deg, #667eea 0%, #764ba2 100%),
                radial-gradient(circle at 30% 40%, rgba(120, 119, 198, 0.3), transparent 50%),
                radial-gradient(circle at 80% 10%, rgba(255, 255, 255, 0.15), transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(120, 119, 198, 0.2), transparent 50%);
            background-attachment: fixed;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Helvetica Neue', Arial, sans-serif;
            color: rgba(255, 255, 255, 0.9);
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            position: relative;
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 255, 255, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(255, 255, 255, 0.08) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }
        
        input, textarea {
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }
        
        /* Apple Glass Header */
        .glass-header {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
            font-weight: 700;
            font-size: 2.5rem;
            color: rgba(255, 255, 255, 0.95);
            text-align: center;
            margin-bottom: 2rem;
            letter-spacing: -0.02em;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.6));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        /* Glass Morphism Containers */
        .glass-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            padding: 2rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .glass-container:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-4px);
            box-shadow: 
                0 12px 40px rgba(0, 0, 0, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }
        
        /* Apple Style Buttons */
        .glass-button {
            background: rgba(255, 255, 255, 0.2) !important;
            backdrop-filter: blur(10px) !important;
            -webkit-backdrop-filter: blur(10px) !important;
            border: 1px solid rgba(255, 255, 255, 0.3) !important;
            border-radius: 12px !important;
            color: rgba(255, 255, 255, 0.95) !important;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif !important;
            font-weight: 600 !important;
            font-size: 1rem !important;
            padding: 12px 24px !important;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1) !important;
            cursor: pointer !important;
            text-shadow: none !important;
            box-shadow: 
                0 4px 16px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.2) !important;
        }
        
        .glass-button:hover {
            background: rgba(255, 255, 255, 0.3) !important;
            transform: translateY(-1px) !important;
            box-shadow: 
                0 6px 20px rgba(0, 0, 0, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.3) !important;
        }
        
        .glass-button:active {
            transform: translateY(0) !important;
            background: rgba(255, 255, 255, 0.25) !important;
        }
        
        /* Glass Input Fields */
        .glass-input input {
            background: rgba(255, 255, 255, 0.08) !important;
            backdrop-filter: blur(20px) !important;
            -webkit-backdrop-filter: blur(20px) !important;
            border: 1px solid rgba(255, 255, 255, 0.15) !important;
            border-radius: 16px !important;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif !important;
            color: rgba(255, 255, 255, 0.95) !important;
            font-size: 1.1rem !important;
            font-weight: 500 !important;
            padding: 20px 24px !important;
            width: 100% !important;
            box-sizing: border-box !important;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
            text-align: center !important;
            letter-spacing: 0.01em !important;
            box-shadow: 
                0 4px 20px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.1) !important;
        }
        
        .glass-input input::placeholder {
            color: rgba(255, 255, 255, 0.4) !important;
            font-weight: 400 !important;
            text-align: center !important;
        }
        
        .glass-input input:focus {
            background: rgba(255, 255, 255, 0.12) !important;
            border-color: rgba(255, 255, 255, 0.3) !important;
            box-shadow: 
                0 0 0 4px rgba(255, 255, 255, 0.08),
                0 8px 32px rgba(0, 0, 0, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.2) !important;
            outline: none !important;
            transform: translateY(-2px) !important;
        }
        
        .glass-input input:hover:not(:focus) {
            background: rgba(255, 255, 255, 0.1) !important;
            border-color: rgba(255, 255, 255, 0.2) !important;
            transform: translateY(-1px) !important;
        }
        
        /* Typography */
        .glass-title {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
            font-weight: 700;
            font-size: 1.75rem;
            color: rgba(255, 255, 255, 0.95);
            margin-bottom: 1rem;
            letter-spacing: -0.01em;
        }
        
        .glass-subtitle {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif;
            font-weight: 400;
            font-size: 1.1rem;
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.5;
            margin-bottom: 1.5rem;
        }
        
        /* Apple-style transition effects */
        .glass-glow {
            animation: glassGlow 2s ease-in-out;
        }
        
        @keyframes glassGlow {
            0% { 
                transform: scale(1);
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            }
            50% { 
                transform: scale(1.02);
                box-shadow: 
                    0 12px 40px rgba(255, 255, 255, 0.2),
                    0 0 60px rgba(255, 255, 255, 0.1);
            }
            100% { 
                transform: scale(1);
                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            }
        }
        
        .success-message {
            animation: successSlide 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes successSlide {
            0% { 
                opacity: 0; 
                transform: translateY(-20px) scale(0.95); 
            }
            100% { 
                opacity: 1; 
                transform: translateY(0) scale(1); 
            }
        }
        
        /* Error shake animation for wrong answers */
        .error-shake {
            animation: errorShake 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes errorShake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-8px); }
            20%, 40%, 60%, 80% { transform: translateX(8px); }
        }
        
        /* Input field error animation */
        .input-error {
            animation: inputError 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes inputError {
            0% { border-color: rgba(255, 255, 255, 0.15); }
            50% { 
                border-color: rgba(255, 69, 58, 0.8); 
                box-shadow: 0 0 0 4px rgba(255, 69, 58, 0.2);
            }
            100% { border-color: rgba(255, 255, 255, 0.15); }
        }
        
        /* Button press animation */
        .button-press {
            animation: buttonPress 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes buttonPress {
            0% { transform: scale(1); }
            50% { transform: scale(0.95); }
            100% { transform: scale(1); }
        }
        
        /* Message slide in animation */
        .message-slide-in {
            animation: messageSlideIn 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes messageSlideIn {
            0% { 
                opacity: 0; 
                transform: translateY(20px) scale(0.9); 
            }
            100% { 
                opacity: 1; 
                transform: translateY(0) scale(1); 
            }
        }
        
        .puzzle-container {
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .fade-out {
            opacity: 0;
            transform: translateY(-30px) scale(0.95);
        }
        
        .fade-in {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
        
        /* Message styling */
        .glass-message {
            background: rgba(255, 255, 255, 0.15) !important;
            backdrop-filter: blur(20px) !important;
            -webkit-backdrop-filter: blur(20px) !important;
            border: 1px solid rgba(255, 255, 255, 0.2) !important;
            border-radius: 16px !important;
            color: rgba(255, 255, 255, 0.9) !important;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif !important;
            font-weight: 500 !important;
            padding: 16px 20px !important;
        }
        
        .glass-message.positive {
            background: rgba(52, 199, 89, 0.2) !important;
            border-color: rgba(52, 199, 89, 0.3) !important;
        }
        
        .glass-message.negative {
            background: rgba(255, 69, 58, 0.2) !important;
            border-color: rgba(255, 69, 58, 0.3) !important;
        }
        
        /* Container spacing */
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }
        
        .puzzle-spacing {
            margin: 3rem auto;
        }


    </style>
</head>
<body>

    <!-- Puzzle Game Section -->
    <div class="container">
        <h1 class="glass-header">Seattle Puzzles</h1>
        
        <!-- Player Info Bar (shown when player name exists) -->
        <div id="player-info-bar" class="glass-container" style="display: none; margin-bottom: 2rem; padding: 1.5rem;">
            <!-- Mobile-optimized layout -->
            <div style="margin-bottom: 1rem;">
                <!-- Player name and change button - mobile stacked -->
                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 1rem;">
                    <div style="flex: 1; min-width: 0;">
                        <div style="font-size: 0.9rem; font-weight: 500; opacity: 0.8; margin-bottom: 0.2rem;">Welcome back</div>
                        <div id="player-name-display" style="font-size: 1.1rem; font-weight: 600; color: rgba(255, 255, 255, 0.95); word-break: break-word;"></div>
                    </div>
                    <button id="change-name-btn" class="glass-button" style="font-size: 0.8rem; padding: 6px 12px; background: rgba(255, 255, 255, 0.1) !important; white-space: nowrap; flex-shrink: 0;">
                        Change Name
                    </button>
                </div>
                
                <!-- Progress section -->
                <div style="margin-bottom: 1rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                        <span style="font-size: 0.85rem; opacity: 0.8;">Progress</span>
                        <span id="progress-text" style="font-size: 0.85rem; font-weight: 500;"></span>
                    </div>
                    <div style="background: rgba(255, 255, 255, 0.1); border-radius: 8px; height: 6px; overflow: hidden;">
                        <div id="progress-bar" style="background: linear-gradient(90deg, #34c759, #30d158); height: 100%; width: 0%; transition: width 0.3s ease;"></div>
                    </div>
                </div>
            </div>
            
            <!-- Mobile-optimized puzzle navigation -->
            <div id="puzzle-nav" style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
                <button class="puzzle-nav-btn" data-puzzle="1" style="padding: 10px 8px; border-radius: 8px; font-size: 0.8rem; border: 1px solid rgba(255, 255, 255, 0.2); background: rgba(255, 255, 255, 0.1); color: rgba(255, 255, 255, 0.9); cursor: pointer; transition: all 0.2s; text-align: center; min-height: 40px; display: flex; align-items: center; justify-content: center;">Puzzle 1</button>
                <button class="puzzle-nav-btn" data-puzzle="2" style="padding: 10px 8px; border-radius: 8px; font-size: 0.8rem; border: 1px solid rgba(255, 255, 255, 0.2); background: rgba(255, 255, 255, 0.1); color: rgba(255, 255, 255, 0.9); cursor: pointer; transition: all 0.2s; text-align: center; min-height: 40px; display: flex; align-items: center; justify-content: center;">Puzzle 2</button>
                <button class="puzzle-nav-btn" data-puzzle="3" style="padding: 10px 8px; border-radius: 8px; font-size: 0.8rem; border: 1px solid rgba(255, 255, 255, 0.2); background: rgba(255, 255, 255, 0.1); color: rgba(255, 255, 255, 0.9); cursor: pointer; transition: all 0.2s; text-align: center; min-height: 40px; display: flex; align-items: center; justify-content: center;">Puzzle 3</button>
                <button class="puzzle-nav-btn" data-puzzle="4" style="padding: 10px 8px; border-radius: 8px; font-size: 0.8rem; border: 1px solid rgba(255, 255, 255, 0.2); background: rgba(255, 255, 255, 0.1); color: rgba(255, 255, 255, 0.9); cursor: pointer; transition: all 0.2s; text-align: center; min-height: 40px; display: flex; align-items: center; justify-content: center;">Puzzle 4</button>
            </div>
            
            <!-- Feedback Button -->
            <div style="margin-top: 16px; text-align: center;">
                <button id="feedback-btn" class="glass-button" style="font-size: 0.8rem; padding: 8px 16px; background: rgba(255, 255, 255, 0.15) !important; border: 1px solid rgba(255, 255, 255, 0.3) !important; color: rgba(255, 255, 255, 0.9) !important; border-radius: 12px; min-height: 36px;">
                    💬 Share Feedback
                </button>
            </div>
        </div>
        
        <!-- Player Name Input -->
        <div id="player-name-section" class="glass-container puzzle-spacing">
            <div class="glass-title" style="text-align:center;">Welcome, Puzzle Solver!</div>
            <div class="glass-subtitle" style="text-align:center;">
                Before we begin your Seattle adventure,<br>
                what should we call you?
            </div>
            <form id="player-name-form" class="glass-input" style="margin: 2rem 0;">
                <input type="text" id="player-name-input" placeholder="Enter your name" required maxlength="50">
                <button class="glass-button" type="submit" style="width:100%; margin-top: 24px;">Start Adventure</button>
            </form>
        </div>
        
        <!-- Puzzle 1 -->
        <div id="puzzle1" class="glass-container puzzle-container puzzle-spacing" style="display: none; opacity: 0;">
            <div class="glass-title" style="text-align:center;">Puzzle 1</div>
            <div id="welcome-message" class="glass-subtitle" style="text-align:center; margin-bottom: 1rem;">
                <!-- Welcome message will be inserted here -->
            </div>
            <div class="glass-subtitle" style="text-align:center;">
                三球如梦，藏林于城。<br>
                镜影如诗，谜途始发。
            </div>
            <form id="puzzle1-form" class="glass-input" style="margin: 2rem 0;">
                <input type="text" placeholder="Enter your answer" required>
                <button class="glass-button" type="submit" style="width:100%; margin-top: 24px;">Submit</button>
            </form>
            <div id="puzzle1-message" class="glass-message" style="display:none; margin-top: 20px;"></div>
        </div>

        <!-- Puzzle 2 -->
        <div id="puzzle2" class="glass-container puzzle-container puzzle-spacing" style="display: none; opacity: 0;">
            <div class="glass-title" style="text-align:center;">Puzzle 2</div>
            <div class="glass-subtitle" style="text-align:center;">
                出球向东北，右转第七街。<br>
                车流交汇处，三角孤岛中。<br>
                形似水泥袋，枕形金属云。<br>
                ——寻觅那云中俳句，<br>
                且听风吟，感其金属之心，是何铸其形？
            </div>
            <form id="puzzle2-form" class="glass-input" style="margin: 2rem 0;">
                <input type="text" placeholder="Enter your answer" required>
                <button class="glass-button" type="submit" style="width:100%; margin-top: 24px;">Submit</button>
            </form>
            <div id="puzzle2-message" class="glass-message" style="display:none; margin-top: 20px;"></div>
        </div>

        <!-- Puzzle 3 -->
        <div id="puzzle3" class="glass-container puzzle-container puzzle-spacing" style="display: none; opacity: 0;">
            <div class="glass-title" style="text-align:center;">Puzzle 3</div>
            <div class="glass-subtitle" style="text-align:center;">
                沿街向北，绿影之侧，<br>
                三人并立，不语凝思。<br>
                童年记忆，铸身为像，<br>
                目光游移，各守心池。<br>
                ——觅那三影静默，<br>
                倾听岁月轻诉，<br>
                哪年春秋，凝铸此形？
            </div>
            <form id="puzzle3-form" class="glass-input" style="margin: 2rem 0;">
                <input type="text" placeholder="Enter your answer" required>
                <button class="glass-button" type="submit" style="width:100%; margin-top: 24px;">Submit</button>
            </form>
            <div id="puzzle3-message" class="glass-message" style="display:none; margin-top: 20px;"></div>
        </div>

        <!-- Puzzle 4 -->
        <div id="puzzle4" class="glass-container puzzle-container puzzle-spacing" style="display: none; opacity: 0;">
            <div class="glass-title" style="text-align:center;">Puzzle 4</div>
            <div class="glass-subtitle" style="text-align:center;">
                告别铜影三人，漫步西湖路，<br>
                棋纹黑与白，点缀几抹朱。<br>
                她俯身入梦，目光越尘雾，<br>
                足托鱼轻跃，心随云起伏。<br>
                ——她是谁？名如其姿，心随远云去。
            </div>
            <form id="puzzle4-form" class="glass-input" style="margin: 2rem 0;">
                <input type="text" placeholder="Enter your answer" required>
                <button class="glass-button" type="submit" style="width:100%; margin-top: 24px;">Submit</button>
            </form>
            <div id="puzzle4-message" class="glass-message" style="display:none; margin-top: 20px;"></div>
        </div>

        <!-- Credits Card (shown after completing all puzzles) -->
        <div id="credits-card" class="glass-container puzzle-container puzzle-spacing" style="display: none; opacity: 0;">
            <div class="glass-title" style="text-align:center;">🎉 Congratulations! 🎉</div>
            <div class="glass-subtitle" style="text-align:center; margin-bottom: 2rem;">
                You've completed all four Seattle puzzles!<br>
                <span style="font-size: 1.1rem; font-weight: 600;">You're a true Seattle explorer!</span>
            </div>
            
            <!-- Credits Section -->
            <div style="background: rgba(247, 242, 250, 0.9); border-radius: 12px; padding: 20px; margin: 20px 0; border: 1px solid rgba(231, 224, 236, 1);">
                <h3 style="text-align: center; margin-bottom: 20px; font-size: 1.125rem; color: #1c1b1f; font-weight: 500;">Credits</h3>
                
                <div style="text-align: left; line-height: 1.6; font-size: 0.875rem;">
                    <div style="margin-bottom: 16px; padding: 0 8px;">
                        <strong style="color: #1c1b1f; font-weight: 500; display: block; margin-bottom: 4px;">Puzzle Design:</strong>
                        <span style="color: #49454f;">Gene Gi</span><br>
                        <em style="color: #79747e; font-size: 0.8125rem;">with the help of ChatGPT, Deepseek, and AWS Q CLI</em>
                    </div>
                    
                    <div style="margin-bottom: 16px; padding: 0 8px;">
                        <strong style="color: #1c1b1f; font-weight: 500; display: block; margin-bottom: 4px;">Website Development:</strong>
                        <span style="color: #49454f;">AWS Q CLI</span>
                    </div>
                    
                    <div style="margin-bottom: 16px; padding: 0 8px;">
                        <strong style="color: #1c1b1f; font-weight: 500; display: block; margin-bottom: 4px;">Trip Route Design:</strong>
                        <a href="https://theticket.seattletimes.com/city-guides/so-you-want-to-look-at-public-art-in-south-lake-union/" 
                           target="_blank" 
                           style="color: #6750a4; text-decoration: none; font-weight: 500; border-bottom: 1px solid transparent;">
                            Jas Keimig's Seattle Times Post
                        </a>
                    </div>
                    
                    <div style="margin-bottom: 0; padding: 0 8px;">
                        <strong style="color: #1c1b1f; font-weight: 500; display: block; margin-bottom: 4px;">Inspired by:</strong>
                        <a href="https://ray7mason.github.io/ray_puzzle/" 
                           target="_blank" 
                           style="color: #6750a4; text-decoration: none; font-weight: 500; border-bottom: 1px solid transparent;">
                            Ray's Seattle Puzzle
                        </a><br>
                        <em style="color: #79747e; font-size: 0.8125rem;">and the movie "Elizabethtown"</em>
                    </div>
                </div>
            </div>
            
            <!-- Feedback Section -->
            <div style="background: rgba(247, 242, 250, 0.9); border-radius: 12px; padding: 20px; margin: 20px 0; border: 1px solid rgba(231, 224, 236, 1);">
                <h3 style="text-align: center; margin-bottom: 20px; font-size: 1.125rem; color: #1c1b1f; font-weight: 500;">Share Your Experience</h3>
                
                <div id="feedback-form-container">
                    <form id="feedback-form" style="margin-bottom: 16px;">
                        <div style="margin-bottom: 16px;">
                            <label style="display: block; margin-bottom: 8px; color: #1c1b1f; font-weight: 500; font-size: 0.875rem;">
                                How was your puzzle experience? (1-5 stars)
                            </label>
                            <div id="star-rating" style="display: flex; gap: 4px; margin-bottom: 8px;">
                                <span class="star" data-rating="1" style="font-size: 24px; color: #e7e0ec; cursor: pointer; transition: color 0.2s;">★</span>
                                <span class="star" data-rating="2" style="font-size: 24px; color: #e7e0ec; cursor: pointer; transition: color 0.2s;">★</span>
                                <span class="star" data-rating="3" style="font-size: 24px; color: #e7e0ec; cursor: pointer; transition: color 0.2s;">★</span>
                                <span class="star" data-rating="4" style="font-size: 24px; color: #e7e0ec; cursor: pointer; transition: color 0.2s;">★</span>
                                <span class="star" data-rating="5" style="font-size: 24px; color: #e7e0ec; cursor: pointer; transition: color 0.2s;">★</span>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 16px;">
                            <label style="display: block; margin-bottom: 8px; color: #1c1b1f; font-weight: 500; font-size: 0.875rem;">
                                Comments or suggestions (optional):
                            </label>
                            <textarea id="feedback-text" 
                                      placeholder="Tell us what you thought about the puzzles, difficulty level, or any suggestions for improvement..."
                                      style="width: 100%; min-height: 80px; padding: 12px; border: 1px solid #79747e; border-radius: 4px; font-family: 'Roboto', sans-serif; font-size: 0.875rem; color: #1c1b1f; background: #ffffff; resize: vertical; box-sizing: border-box;"
                                      maxlength="500"></textarea>
                            <div style="text-align: right; font-size: 0.75rem; color: #79747e; margin-top: 4px;">
                                <span id="char-count">0</span>/500 characters
                            </div>
                        </div>
                        
                        <button type="submit" id="feedback-submit-btn" 
                                style="background: #6750a4; color: white; border: none; padding: 12px 24px; border-radius: 20px; font-weight: 500; font-size: 0.875rem; cursor: pointer; transition: all 0.2s; text-transform: uppercase; letter-spacing: 0.1px; font-family: 'Roboto', sans-serif; width: 100%;">
                            Submit Feedback
                        </button>
                    </form>
                    
                    <div id="feedback-message" class="glass-message" style="display: none; margin-top: 16px;"></div>
                </div>
                
                <div id="feedback-thank-you" style="display: none; text-align: center; padding: 20px;">
                    <div style="font-size: 2rem; margin-bottom: 12px;">🙏</div>
                    <div style="font-size: 1rem; color: #1c1b1f; font-weight: 500; margin-bottom: 8px;">
                        Thank you for your feedback!
                    </div>
                    <div style="font-size: 0.875rem; color: #49454f;">
                        Your input helps us improve the puzzle experience for everyone.
                    </div>
                </div>
            </div>
            
            <!-- Thank You Message -->
            <div style="text-align: center; margin-top: 24px;">
                <p style="font-size: 1rem; color: #49454f; margin-bottom: 16px; font-weight: 400;">
                    Thank you for exploring Seattle's public art with us!
                </p>
                <button id="restart-game-btn" class="glass-button">
                    Play Again
                </button>
            </div>
        </div>
        
        <!-- Feedback Modal (available from any puzzle) -->
        <div id="feedback-modal" class="feedback-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 1000; backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px);">
            <div class="feedback-modal-content" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #ffffff; border-radius: 16px; padding: 24px; max-width: 500px; width: 90%; max-height: 80vh; overflow-y: auto; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);">
                <!-- Modal Header -->
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="margin: 0; color: #1c1b1f; font-size: 1.25rem; font-weight: 500; font-family: 'Roboto', sans-serif;">Share Your Feedback</h3>
                    <button id="feedback-modal-close" style="background: none; border: none; font-size: 24px; color: #79747e; cursor: pointer; padding: 4px; border-radius: 50%; transition: background-color 0.2s;">×</button>
                </div>
                
                <!-- Feedback Form Container -->
                <div id="modal-feedback-form-container">
                    <form id="modal-feedback-form" style="margin-bottom: 16px;">
                        <div style="margin-bottom: 16px;">
                            <label style="display: block; margin-bottom: 8px; color: #1c1b1f; font-weight: 500; font-size: 0.875rem; font-family: 'Roboto', sans-serif;">
                                How is your puzzle experience so far? (1-5 stars)
                            </label>
                            <div id="modal-star-rating" style="display: flex; gap: 4px; margin-bottom: 8px;">
                                <span class="modal-star" data-rating="1" style="font-size: 28px; color: #e7e0ec; cursor: pointer; transition: color 0.2s; user-select: none; -webkit-user-select: none;">★</span>
                                <span class="modal-star" data-rating="2" style="font-size: 28px; color: #e7e0ec; cursor: pointer; transition: color 0.2s; user-select: none; -webkit-user-select: none;">★</span>
                                <span class="modal-star" data-rating="3" style="font-size: 28px; color: #e7e0ec; cursor: pointer; transition: color 0.2s; user-select: none; -webkit-user-select: none;">★</span>
                                <span class="modal-star" data-rating="4" style="font-size: 28px; color: #e7e0ec; cursor: pointer; transition: color 0.2s; user-select: none; -webkit-user-select: none;">★</span>
                                <span class="modal-star" data-rating="5" style="font-size: 28px; color: #e7e0ec; cursor: pointer; transition: color 0.2s; user-select: none; -webkit-user-select: none;">★</span>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 16px;">
                            <label style="display: block; margin-bottom: 8px; color: #1c1b1f; font-weight: 500; font-size: 0.875rem; font-family: 'Roboto', sans-serif;">
                                Comments or suggestions (optional):
                            </label>
                            <textarea id="modal-feedback-text" 
                                      placeholder="Tell us about your experience, difficulty level, or any suggestions..."
                                      style="width: 100%; min-height: 100px; padding: 12px; border: 1px solid #79747e; border-radius: 4px; font-family: 'Roboto', sans-serif; font-size: 0.875rem; color: #1c1b1f; background: #ffffff; resize: vertical; box-sizing: border-box; transition: border-color 0.2s;"
                                      maxlength="500"></textarea>
                            <div style="text-align: right; font-size: 0.75rem; color: #79747e; margin-top: 4px; font-family: 'Roboto', sans-serif;">
                                <span id="modal-char-count">0</span>/500 characters
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 12px; justify-content: flex-end;">
                            <button type="button" id="modal-feedback-cancel" 
                                    style="background: transparent; color: #6750a4; border: 1px solid #6750a4; padding: 10px 20px; border-radius: 20px; font-weight: 500; font-size: 0.875rem; cursor: pointer; transition: all 0.2s; font-family: 'Roboto', sans-serif; text-transform: uppercase; letter-spacing: 0.1px;">
                                Cancel
                            </button>
                            <button type="submit" id="modal-feedback-submit-btn" 
                                    style="background: #6750a4; color: white; border: none; padding: 10px 20px; border-radius: 20px; font-weight: 500; font-size: 0.875rem; cursor: pointer; transition: all 0.2s; font-family: 'Roboto', sans-serif; text-transform: uppercase; letter-spacing: 0.1px;">
                                Submit Feedback
                            </button>
                        </div>
                    </form>
                    
                    <div id="modal-feedback-message" class="glass-message" style="display: none; margin-top: 16px; background: #e8f5e8; color: #1b5e20; border: 1px solid #4caf50; border-radius: 8px; padding: 12px;"></div>
                </div>
                
                <div id="modal-feedback-thank-you" style="display: none; text-align: center; padding: 20px;">
                    <div style="font-size: 3rem; margin-bottom: 16px;">🙏</div>
                    <div style="font-size: 1.125rem; color: #1c1b1f; font-weight: 500; margin-bottom: 8px; font-family: 'Roboto', sans-serif;">
                        Thank you for your feedback!
                    </div>
                    <div style="font-size: 0.875rem; color: #49454f; margin-bottom: 20px; font-family: 'Roboto', sans-serif;">
                        Your input helps us improve the puzzle experience.
                    </div>
                    <button id="modal-continue-btn" 
                            style="background: #6750a4; color: white; border: none; padding: 12px 24px; border-radius: 20px; font-weight: 500; font-size: 0.875rem; cursor: pointer; transition: all 0.2s; font-family: 'Roboto', sans-serif; text-transform: uppercase; letter-spacing: 0.1px;">
                        Continue Playing
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
    // Player name management with localStorage and puzzle progress
    let playerName = '';
    let puzzleProgress = {
        completed: [], // Array of completed puzzle numbers
        currentPuzzle: 1 // Current puzzle number
    };
    
    // Check for existing player name and progress on page load
    document.addEventListener('DOMContentLoaded', function() {
        const savedPlayerName = localStorage.getItem('seattlePuzzlePlayerName');
        const savedProgress = localStorage.getItem('seattlePuzzleProgress');
        
        if (savedPlayerName) {
            playerName = savedPlayerName;
            
            // Load puzzle progress
            if (savedProgress) {
                try {
                    puzzleProgress = JSON.parse(savedProgress);
                } catch (e) {
                    console.log('Error parsing saved progress, using defaults');
                    puzzleProgress = { completed: [], currentPuzzle: 1 };
                }
            }
            
            // Show player info bar with progress
            showPlayerInfoBar();
            // Skip name input and go directly to current puzzle
            document.getElementById('player-name-section').style.display = 'none';
            showCurrentPuzzle();
            
            // Track returning player with progress
            if (typeof window.trackPuzzleEvent === 'function') {
                window.trackPuzzleEvent({
                    eventType: 'returning_player',
                    playerName: playerName,
                    category: 'game_start',
                    completedPuzzles: puzzleProgress.completed.length,
                    currentPuzzle: puzzleProgress.currentPuzzle
                });
            }
        }
        
        // Set up change name button event listener
        setupChangeNameButton();
    });
    
    // Player name form handler
    document.getElementById('player-name-form').addEventListener('submit', function(e) {
        e.preventDefault();
        console.log('Form submitted'); // Debug log
        
        const nameInput = document.getElementById('player-name-input');
        playerName = nameInput.value.trim();
        console.log('Player name:', playerName); // Debug log
        
        if (playerName.length === 0) {
            console.log('Empty name, returning'); // Debug log
            return;
        }
        
        // Save player name to localStorage
        localStorage.setItem('seattlePuzzlePlayerName', playerName);
        
        // Track player name entry with Firebase
        if (typeof window.trackPuzzleEvent === 'function') {
            window.trackPuzzleEvent({
                eventType: 'player_name_entered',
                playerName: playerName,
                category: 'game_start',
                label: 'player_registration'
            });
        }
        
        // Hide name section and show first puzzle
        const nameSection = document.getElementById('player-name-section');
        const puzzle1 = document.getElementById('puzzle1');
        
        console.log('Name section found:', !!nameSection); // Debug log
        console.log('Puzzle1 found:', !!puzzle1); // Debug log
        
        if (!nameSection || !puzzle1) {
            console.error('Required elements not found');
            return;
        }
        
        nameSection.classList.add('fade-out');
        console.log('Added fade-out class'); // Debug log
        
        setTimeout(() => {
            console.log('Executing transition'); // Debug log
            nameSection.style.display = 'none';
            puzzle1.style.display = 'block';
            puzzle1.classList.add('fade-in');
            puzzle1.style.opacity = '1';
            
            // Show player info bar
            showPlayerInfoBar();
            
            // Update puzzle header to include player name
            updatePuzzleGreeting();
            
            // Initialize game timing
            window.gameStartTime = Date.now();
            window.puzzle1StartTime = Date.now();
            
            console.log('Transition complete'); // Debug log
        }, 1000);
    });
    
    // Function to show player info bar
    function showPlayerInfoBar() {
        const playerInfoBar = document.getElementById('player-info-bar');
        const playerNameDisplay = document.getElementById('player-name-display');
        
        if (playerInfoBar && playerNameDisplay && playerName) {
            playerNameDisplay.textContent = playerName;
            playerInfoBar.style.display = 'block';
            updateProgressDisplay();
            setupPuzzleNavigation();
            setupFeedbackButton();
        }
    }
    
    // Function to update progress display
    function updateProgressDisplay() {
        const progressText = document.getElementById('progress-text');
        const progressBar = document.getElementById('progress-bar');
        const navButtons = document.querySelectorAll('.puzzle-nav-btn');
        
        if (progressText && progressBar) {
            const completedCount = puzzleProgress.completed.length;
            const progressPercent = (completedCount / 4) * 100;
            
            progressText.textContent = `${completedCount}/4 puzzles completed`;
            progressBar.style.width = `${progressPercent}%`;
        }
        
        // Update navigation buttons
        navButtons.forEach(btn => {
            const puzzleNum = parseInt(btn.dataset.puzzle);
            const isCompleted = puzzleProgress.completed.includes(puzzleNum);
            const isCurrent = puzzleNum === puzzleProgress.currentPuzzle;
            const isAccessible = puzzleNum <= puzzleProgress.currentPuzzle;
            
            // Reset styles
            btn.style.background = 'rgba(255, 255, 255, 0.1)';
            btn.style.color = 'rgba(255, 255, 255, 0.9)';
            btn.style.border = '1px solid rgba(255, 255, 255, 0.2)';
            btn.style.cursor = 'pointer';
            btn.style.opacity = '1';
            
            if (isCompleted) {
                // Completed puzzle - green
                btn.style.background = 'rgba(52, 199, 89, 0.3)';
                btn.style.border = '1px solid rgba(52, 199, 89, 0.5)';
                btn.innerHTML = `Puzzle ${puzzleNum} ✓`;
            } else if (isCurrent) {
                // Current puzzle - highlighted
                btn.style.background = 'rgba(255, 255, 255, 0.2)';
                btn.style.border = '1px solid rgba(255, 255, 255, 0.4)';
                btn.innerHTML = `Puzzle ${puzzleNum} →`;
            } else if (!isAccessible) {
                // Locked puzzle - dimmed
                btn.style.opacity = '0.5';
                btn.style.cursor = 'not-allowed';
                btn.innerHTML = `Puzzle ${puzzleNum} 🔒`;
            } else {
                btn.innerHTML = `Puzzle ${puzzleNum}`;
            }
        });
    }
    
    // Function to setup puzzle navigation
    function setupPuzzleNavigation() {
        const navButtons = document.querySelectorAll('.puzzle-nav-btn');
        
        navButtons.forEach(btn => {
            btn.addEventListener('click', function() {
                const puzzleNum = parseInt(this.dataset.puzzle);
                const isAccessible = puzzleNum <= puzzleProgress.currentPuzzle;
                
                if (isAccessible) {
                    navigateToPuzzle(puzzleNum);
                    
                    // Track puzzle navigation
                    if (typeof window.trackPuzzleEvent === 'function') {
                        window.trackPuzzleEvent({
                            eventType: 'puzzle_navigation',
                            playerName: playerName,
                            fromPuzzle: getCurrentVisiblePuzzle(),
                            toPuzzle: puzzleNum,
                            category: 'user_interaction'
                        });
                    }
                }
            });
        });
    }
    
    // Function to navigate to a specific puzzle
    function navigateToPuzzle(puzzleNum) {
        // Hide all puzzles
        for (let i = 1; i <= 4; i++) {
            const puzzle = document.getElementById(`puzzle${i}`);
            if (puzzle) {
                puzzle.style.display = 'none';
                puzzle.style.opacity = '0';
            }
        }
        
        // Show target puzzle
        const targetPuzzle = document.getElementById(`puzzle${puzzleNum}`);
        if (targetPuzzle) {
            targetPuzzle.style.display = 'block';
            targetPuzzle.style.opacity = '1';
            
            // Initialize timing for this puzzle if not already set
            if (!window[`puzzle${puzzleNum}StartTime`]) {
                window[`puzzle${puzzleNum}StartTime`] = Date.now();
            }
        }
        
        updateProgressDisplay();
    }
    
    // Function to show current puzzle based on progress
    function showCurrentPuzzle() {
        navigateToPuzzle(puzzleProgress.currentPuzzle);
        updatePuzzleGreeting();
        
        // Initialize game timing
        if (!window.gameStartTime) {
            window.gameStartTime = Date.now();
        }
        if (!window[`puzzle${puzzleProgress.currentPuzzle}StartTime`]) {
            window[`puzzle${puzzleProgress.currentPuzzle}StartTime`] = Date.now();
        }
    }
    
    // Function to get currently visible puzzle number
    function getCurrentVisiblePuzzle() {
        for (let i = 1; i <= 4; i++) {
            const puzzle = document.getElementById(`puzzle${i}`);
            if (puzzle && puzzle.style.display !== 'none' && puzzle.style.opacity !== '0') {
                return i;
            }
        }
        return 1;
    }
    
    // Function to add visual feedback for user interactions
    function addInteractionFeedback(isCorrect, puzzleNum, inputElement, buttonElement, messageDiv) {
        // Add button press animation
        if (buttonElement) {
            buttonElement.classList.add('button-press');
            setTimeout(() => {
                buttonElement.classList.remove('button-press');
            }, 200);
        }
        
        if (isCorrect) {
            // Success animations
            if (messageDiv) {
                messageDiv.classList.add('success-message', 'message-slide-in');
            }
        } else {
            // Error animations
            const puzzleContainer = document.getElementById(`puzzle${puzzleNum}`);
            
            // Shake the puzzle container
            if (puzzleContainer) {
                puzzleContainer.classList.add('error-shake');
                setTimeout(() => {
                    puzzleContainer.classList.remove('error-shake');
                }, 600);
            }
            
            // Error animation for input field
            if (inputElement) {
                inputElement.classList.add('input-error');
                setTimeout(() => {
                    inputElement.classList.remove('input-error');
                }, 400);
                
                // Clear the input and refocus for better UX
                setTimeout(() => {
                    inputElement.value = '';
                    inputElement.focus();
                }, 300);
            }
            
            // Message slide in animation
            if (messageDiv) {
                messageDiv.classList.add('message-slide-in');
                setTimeout(() => {
                    messageDiv.classList.remove('message-slide-in');
                }, 500);
            }
        }
    }
    
    // Function to mark puzzle as completed and advance
    function completePuzzle(puzzleNum) {
        // Mark as completed if not already
        if (!puzzleProgress.completed.includes(puzzleNum)) {
            puzzleProgress.completed.push(puzzleNum);
        }
        
        // Advance to next puzzle if not at the end
        if (puzzleNum < 4) {
            puzzleProgress.currentPuzzle = puzzleNum + 1;
        }
        
        // Save progress
        localStorage.setItem('seattlePuzzleProgress', JSON.stringify(puzzleProgress));
        
        // Update display
        updateProgressDisplay();
    }
    
    // Function to show credits card
    function showCreditsCard() {
        // Hide current puzzle
        const puzzle4 = document.getElementById('puzzle4');
        if (puzzle4) {
            puzzle4.style.display = 'none';
            puzzle4.style.opacity = '0';
        }
        
        // Hide player info bar
        const playerInfoBar = document.getElementById('player-info-bar');
        if (playerInfoBar) {
            playerInfoBar.style.display = 'none';
        }
        
        // Show credits card
        const creditsCard = document.getElementById('credits-card');
        if (creditsCard) {
            creditsCard.style.display = 'block';
            creditsCard.classList.add('fade-in');
            creditsCard.style.opacity = '1';
        }
        
        // Set up restart button and feedback system
        setupRestartButton();
        setupFeedbackSystem();
        
        // Track credits view
        if (typeof window.trackPuzzleEvent === 'function') {
            window.trackPuzzleEvent({
                eventType: 'credits_viewed',
                playerName: playerName,
                category: 'game_completion'
            });
        }
    }
    
    // Function to set up restart button
    function setupRestartButton() {
        const restartBtn = document.getElementById('restart-game-btn');
        if (restartBtn) {
            restartBtn.addEventListener('click', function() {
                // Track restart
                if (typeof window.trackPuzzleEvent === 'function') {
                    window.trackPuzzleEvent({
                        eventType: 'game_restart',
                        playerName: playerName,
                        category: 'user_interaction'
                    });
                }
                
                // Clear all progress
                localStorage.removeItem('seattlePuzzlePlayerName');
                localStorage.removeItem('seattlePuzzleProgress');
                
                // Reload page to start fresh
                window.location.reload();
            });
        }
    }
    
    // Function to set up feedback system
    function setupFeedbackSystem() {
        const stars = document.querySelectorAll('.star');
        const feedbackForm = document.getElementById('feedback-form');
        const feedbackText = document.getElementById('feedback-text');
        const charCount = document.getElementById('char-count');
        const feedbackMessage = document.getElementById('feedback-message');
        const feedbackContainer = document.getElementById('feedback-form-container');
        const thankYouSection = document.getElementById('feedback-thank-you');
        
        let selectedRating = 0;
        
        // Star rating interaction
        stars.forEach(star => {
            star.addEventListener('click', function() {
                selectedRating = parseInt(this.dataset.rating);
                updateStarDisplay();
                
                // Add click animation
                this.style.transform = 'scale(1.2)';
                setTimeout(() => {
                    this.style.transform = 'scale(1)';
                }, 150);
                
                // Track star rating interaction
                if (typeof window.trackPuzzleEvent === 'function') {
                    window.trackPuzzleEvent({
                        eventType: 'feedback_rating_selected',
                        playerName: playerName,
                        rating: selectedRating,
                        category: 'feedback_interaction'
                    });
                }
            });
            
            star.addEventListener('mouseover', function() {
                const hoverRating = parseInt(this.dataset.rating);
                highlightStars(hoverRating);
            });
            
            star.addEventListener('mouseout', function() {
                updateStarDisplay();
            });
        });
        
        // Reset stars on mouse leave
        document.getElementById('star-rating').addEventListener('mouseleave', function() {
            updateStarDisplay();
        });
        
        // Character counter for textarea
        if (feedbackText && charCount) {
            feedbackText.addEventListener('input', function() {
                const currentLength = this.value.length;
                charCount.textContent = currentLength;
                
                // Change color when approaching limit
                if (currentLength > 450) {
                    charCount.style.color = '#d32f2f';
                } else if (currentLength > 400) {
                    charCount.style.color = '#f57c00';
                } else {
                    charCount.style.color = '#79747e';
                }
            });
        }
        
        // Feedback form submission
        if (feedbackForm) {
            feedbackForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                // Validate rating
                if (selectedRating === 0) {
                    showFeedbackMessage('Please select a star rating before submitting.', 'error');
                    return;
                }
                
                const feedbackData = {
                    playerName: playerName,
                    rating: selectedRating,
                    comment: feedbackText.value.trim(),
                    completedPuzzles: puzzleProgress.completed.length,
                    totalGameTime: Date.now() - (window.gameStartTime || Date.now())
                };
                
                // Show loading state
                const submitBtn = document.getElementById('feedback-submit-btn');
                const originalText = submitBtn.textContent;
                submitBtn.textContent = 'Submitting...';
                submitBtn.disabled = true;
                
                try {
                    // Submit feedback to Firebase
                    const result = await window.submitFeedback(feedbackData);
                    
                    if (result.success) {
                        // Track successful feedback submission
                        if (typeof window.trackPuzzleEvent === 'function') {
                            window.trackPuzzleEvent({
                                eventType: 'feedback_submitted',
                                playerName: playerName,
                                rating: selectedRating,
                                hasComment: feedbackData.comment.length > 0,
                                category: 'feedback_completion'
                            });
                        }
                        
                        // Hide form and show thank you message
                        feedbackContainer.style.display = 'none';
                        thankYouSection.style.display = 'block';
                        
                        // Add success animation
                        thankYouSection.classList.add('message-slide-in');
                        
                    } else {
                        throw new Error(result.error || 'Failed to submit feedback');
                    }
                } catch (error) {
                    console.error('Feedback submission error:', error);
                    showFeedbackMessage('Sorry, there was an error submitting your feedback. Please try again.', 'error');
                    
                    // Reset button
                    submitBtn.textContent = originalText;
                    submitBtn.disabled = false;
                }
            });
        }
        
        function updateStarDisplay() {
            stars.forEach((star, index) => {
                star.classList.remove('selected', 'active');
                if (index < selectedRating) {
                    star.style.color = '#ffc107'; // Gold color for selected stars
                    star.classList.add('selected');
                } else {
                    star.style.color = '#e7e0ec'; // Gray color for unselected stars
                }
            });
        }
        
        function highlightStars(rating) {
            stars.forEach((star, index) => {
                star.classList.remove('active');
                if (index < rating) {
                    star.style.color = '#ffc107';
                    star.classList.add('active');
                } else {
                    star.style.color = '#e7e0ec';
                }
            });
        }
        
        function showFeedbackMessage(message, type) {
            if (feedbackMessage) {
                feedbackMessage.textContent = message;
                feedbackMessage.className = `glass-message ${type === 'error' ? 'negative' : 'positive'}`;
                feedbackMessage.style.display = 'block';
                feedbackMessage.classList.add('message-slide-in');
                
                // Auto-hide after 5 seconds
                setTimeout(() => {
                    feedbackMessage.style.display = 'none';
                    feedbackMessage.classList.remove('message-slide-in');
                }, 5000);
            }
        }
    }
    
    // Function to set up feedback button in player info bar
    function setupFeedbackButton() {
        const feedbackBtn = document.getElementById('feedback-btn');
        if (feedbackBtn) {
            feedbackBtn.addEventListener('click', function() {
                showFeedbackModal();
                
                // Track feedback button click
                if (typeof window.trackPuzzleEvent === 'function') {
                    window.trackPuzzleEvent({
                        eventType: 'feedback_button_clicked',
                        playerName: playerName,
                        currentPuzzle: getCurrentVisiblePuzzle(),
                        completedPuzzles: puzzleProgress.completed.length,
                        category: 'feedback_interaction'
                    });
                }
            });
        }
    }
    
    // Function to show feedback modal
    function showFeedbackModal() {
        const modal = document.getElementById('feedback-modal');
        if (modal) {
            modal.style.display = 'block';
            document.body.style.overflow = 'hidden'; // Prevent background scrolling
            
            // Reset form state
            resetModalFeedbackForm();
            
            // Set up modal event listeners
            setupModalFeedbackSystem();
        }
    }
    
    // Function to hide feedback modal
    function hideFeedbackModal() {
        const modal = document.getElementById('feedback-modal');
        if (modal) {
            modal.style.display = 'none';
            document.body.style.overflow = 'auto'; // Restore scrolling
        }
    }
    
    // Function to reset modal feedback form
    function resetModalFeedbackForm() {
        const formContainer = document.getElementById('modal-feedback-form-container');
        const thankYouSection = document.getElementById('modal-feedback-thank-you');
        const form = document.getElementById('modal-feedback-form');
        const textarea = document.getElementById('modal-feedback-text');
        const charCount = document.getElementById('modal-char-count');
        const stars = document.querySelectorAll('.modal-star');
        
        // Show form, hide thank you
        if (formContainer) formContainer.style.display = 'block';
        if (thankYouSection) thankYouSection.style.display = 'none';
        
        // Reset form
        if (form) form.reset();
        if (textarea) textarea.value = '';
        if (charCount) charCount.textContent = '0';
        
        // Reset stars
        stars.forEach(star => {
            star.style.color = '#e7e0ec';
        });
        
        // Reset selected rating
        window.modalSelectedRating = 0;
    }
    
    // Function to set up modal feedback system
    function setupModalFeedbackSystem() {
        const stars = document.querySelectorAll('.modal-star');
        const feedbackForm = document.getElementById('modal-feedback-form');
        const feedbackText = document.getElementById('modal-feedback-text');
        const charCount = document.getElementById('modal-char-count');
        const feedbackMessage = document.getElementById('modal-feedback-message');
        const formContainer = document.getElementById('modal-feedback-form-container');
        const thankYouSection = document.getElementById('modal-feedback-thank-you');
        const closeBtn = document.getElementById('feedback-modal-close');
        const cancelBtn = document.getElementById('modal-feedback-cancel');
        const continueBtn = document.getElementById('modal-continue-btn');
        
        // Initialize selected rating
        if (typeof window.modalSelectedRating === 'undefined') {
            window.modalSelectedRating = 0;
        }
        
        // Star rating interaction
        stars.forEach(star => {
            star.addEventListener('click', function() {
                window.modalSelectedRating = parseInt(this.dataset.rating);
                updateModalStarDisplay();
                
                // Add click animation
                this.style.transform = 'scale(1.2)';
                setTimeout(() => {
                    this.style.transform = 'scale(1)';
                }, 150);
                
                // Track star rating interaction
                if (typeof window.trackPuzzleEvent === 'function') {
                    window.trackPuzzleEvent({
                        eventType: 'modal_feedback_rating_selected',
                        playerName: playerName,
                        rating: window.modalSelectedRating,
                        currentPuzzle: getCurrentVisiblePuzzle(),
                        category: 'feedback_interaction'
                    });
                }
            });
            
            star.addEventListener('mouseover', function() {
                const hoverRating = parseInt(this.dataset.rating);
                highlightModalStars(hoverRating);
            });
            
            star.addEventListener('mouseout', function() {
                updateModalStarDisplay();
            });
        });
        
        // Reset stars on mouse leave
        const starContainer = document.getElementById('modal-star-rating');
        if (starContainer) {
            starContainer.addEventListener('mouseleave', function() {
                updateModalStarDisplay();
            });
        }
        
        // Character counter for textarea
        if (feedbackText && charCount) {
            feedbackText.addEventListener('input', function() {
                const currentLength = this.value.length;
                charCount.textContent = currentLength;
                
                // Change color when approaching limit
                if (currentLength > 450) {
                    charCount.style.color = '#d32f2f';
                } else if (currentLength > 400) {
                    charCount.style.color = '#f57c00';
                } else {
                    charCount.style.color = '#79747e';
                }
            });
        }
        
        // Close button handlers
        if (closeBtn) {
            closeBtn.addEventListener('click', hideFeedbackModal);
        }
        if (cancelBtn) {
            cancelBtn.addEventListener('click', hideFeedbackModal);
        }
        if (continueBtn) {
            continueBtn.addEventListener('click', hideFeedbackModal);
        }
        
        // Click outside to close
        const modal = document.getElementById('feedback-modal');
        if (modal) {
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    hideFeedbackModal();
                }
            });
        }
        
        // Form submission
        if (feedbackForm) {
            feedbackForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                // Validate rating
                if (window.modalSelectedRating === 0) {
                    showModalFeedbackMessage('Please select a star rating before submitting.', 'error');
                    return;
                }
                
                const feedbackData = {
                    playerName: playerName,
                    rating: window.modalSelectedRating,
                    comment: feedbackText.value.trim(),
                    completedPuzzles: puzzleProgress.completed.length,
                    currentPuzzle: getCurrentVisiblePuzzle(),
                    totalGameTime: Date.now() - (window.gameStartTime || Date.now()),
                    feedbackSource: 'modal' // Distinguish from completion feedback
                };
                
                // Show loading state
                const submitBtn = document.getElementById('modal-feedback-submit-btn');
                const originalText = submitBtn.textContent;
                submitBtn.textContent = 'Submitting...';
                submitBtn.disabled = true;
                
                try {
                    // Submit feedback to Firebase
                    const result = await window.submitFeedback(feedbackData);
                    
                    if (result.success) {
                        // Track successful feedback submission
                        if (typeof window.trackPuzzleEvent === 'function') {
                            window.trackPuzzleEvent({
                                eventType: 'modal_feedback_submitted',
                                playerName: playerName,
                                rating: window.modalSelectedRating,
                                hasComment: feedbackData.comment.length > 0,
                                currentPuzzle: getCurrentVisiblePuzzle(),
                                category: 'feedback_completion'
                            });
                        }
                        
                        // Hide form and show thank you message
                        formContainer.style.display = 'none';
                        thankYouSection.style.display = 'block';
                        
                    } else {
                        throw new Error(result.error || 'Failed to submit feedback');
                    }
                } catch (error) {
                    console.error('Modal feedback submission error:', error);
                    showModalFeedbackMessage('Sorry, there was an error submitting your feedback. Please try again.', 'error');
                    
                    // Reset button
                    submitBtn.textContent = originalText;
                    submitBtn.disabled = false;
                }
            });
        }
        
        function updateModalStarDisplay() {
            const stars = document.querySelectorAll('.modal-star');
            stars.forEach((star, index) => {
                star.classList.remove('selected', 'active');
                if (index < window.modalSelectedRating) {
                    star.style.color = '#ffc107'; // Gold color for selected stars
                    star.classList.add('selected');
                } else {
                    star.style.color = '#e7e0ec'; // Gray color for unselected stars
                }
            });
        }
        
        function highlightModalStars(rating) {
            const stars = document.querySelectorAll('.modal-star');
            stars.forEach((star, index) => {
                star.classList.remove('active');
                if (index < rating) {
                    star.style.color = '#ffc107';
                    star.classList.add('active');
                } else {
                    star.style.color = '#e7e0ec';
                }
            });
        }
        
        function showModalFeedbackMessage(message, type) {
            if (feedbackMessage) {
                feedbackMessage.textContent = message;
                feedbackMessage.className = `glass-message ${type === 'error' ? 'negative' : 'positive'}`;
                feedbackMessage.style.display = 'block';
                
                // Auto-hide after 5 seconds
                setTimeout(() => {
                    feedbackMessage.style.display = 'none';
                }, 5000);
            }
        }
    }
    
    // Function to set up change name button
    function setupChangeNameButton() {
        const changeNameBtn = document.getElementById('change-name-btn');
        if (changeNameBtn) {
            changeNameBtn.addEventListener('click', function() {
                // Confirm before clearing progress
                const hasProgress = puzzleProgress.completed.length > 0;
                let shouldClear = true;
                
                if (hasProgress) {
                    shouldClear = confirm(`This will clear your progress (${puzzleProgress.completed.length}/4 puzzles completed). Are you sure?`);
                }
                
                if (shouldClear) {
                    // Clear stored name and progress
                    localStorage.removeItem('seattlePuzzlePlayerName');
                    localStorage.removeItem('seattlePuzzleProgress');
                    
                    // Track name change
                    if (typeof window.trackPuzzleEvent === 'function') {
                        window.trackPuzzleEvent({
                            eventType: 'name_change_requested',
                            playerName: playerName,
                            category: 'user_interaction',
                            progressCleared: hasProgress,
                            completedPuzzles: puzzleProgress.completed.length
                        });
                    }
                    
                    // Reload page to show name input again
                    window.location.reload();
                }
            });
        }
    }
    
    // Function to update puzzle greeting with player name
    function updatePuzzleGreeting() {
        const puzzle1Header = document.querySelector('#puzzle1 .glass-title');
        const welcomeMessage = document.getElementById('welcome-message');
        if (puzzle1Header && playerName) {
            puzzle1Header.textContent = `Puzzle 1 - Welcome, ${playerName}!`;
            if (welcomeMessage) {
                welcomeMessage.innerHTML = `Ready for your Seattle adventure?<br><small style="opacity: 0.7;">Good luck solving the puzzles!</small>`;
            }
        }
    }
    
    // Anti-debugging techniques
    (function() {
        // Disable F12, Ctrl+Shift+I, Ctrl+U
        document.addEventListener('keydown', function(e) {
            if (e.key === 'F12' || 
                (e.ctrlKey && e.shiftKey && e.key === 'I') ||
                (e.ctrlKey && e.key === 'u')) {
                e.preventDefault();
                console.log('%cNice try! 😉', 'color: blue; font-size: 16px;');
                return false;
            }
        });

        // Comprehensive right-click and context menu blocking
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            e.stopPropagation();
            console.log('%cRight-click disabled! 🚫', 'color: orange; font-size: 14px;');
            return false;
        }, true);
        
        // Block right-click on all elements
        document.addEventListener('mousedown', function(e) {
            if (e.button === 2) { // Right mouse button
                e.preventDefault();
                e.stopPropagation();
                return false;
            }
        }, true);
        
        // Block context menu on images and other elements
        document.addEventListener('dragstart', function(e) {
            e.preventDefault();
            return false;
        });
        
        // Block text selection to prevent easy copying
        document.addEventListener('selectstart', function(e) {
            if (e.target.tagName !== 'INPUT' && e.target.tagName !== 'TEXTAREA') {
                e.preventDefault();
                return false;
            }
        });

        // Console warning
        console.log('%cStop!', 'color: red; font-size: 50px; font-weight: bold;');
        console.log('%cThis is a puzzle game. Cheating ruins the fun!', 'color: red; font-size: 20px;');
        
        // Enhanced dev tools detection with answer scrambling
        let devtools = {open: false, orientation: null};
        setInterval(() => {
            const threshold = 160;
            if (window.outerHeight - window.innerHeight > threshold || 
                window.outerWidth - window.innerWidth > threshold) {
                if (!devtools.open) {
                    devtools.open = true;
                    console.clear();
                    console.log('%cPuzzle integrity protected! 🔒', 'color: red; font-size: 20px;');
                    // Scramble answers if devtools detected
                    window._0x4f2a = Array(10).fill(0).map(() => Math.floor(Math.random() * 255));
                    window._0x7b3c = Array(6).fill(0).map(() => Math.floor(Math.random() * 255));
                    window._0x9d4e = Array(4).fill(0).map(() => Math.floor(Math.random() * 255));
                    window._0x7f8g = Array(7).fill(0).map(() => Math.floor(Math.random() * 255));
                }
            } else {
                devtools.open = false;
            }
        }, 500);
    })();

    // Polynomial hash-based validation system
    const _0xPrime = 31; // Prime number for hash function
    const _0xMod = 1000000007; // Large prime modulus
    
    // Pre-computed polynomial hashes of answers
    const _0x4f2a = 0x28A0C550; // Hash of "thespheres"
    const _0x7b3c = 0x740505; // Hash of "bronze"  
    const _0x9d4e = 0x194AFE; // Hash of "2006"
    const _0x7f8g = 0xA2B738B; // Hash of "dreamer"
    
    // Decoy hashes to confuse reverse engineering
    const _0x1a2b = 0x9B4C7E2F;
    const _0x3c4d = 0x5A8D1F6C;
    const _0x5e6f = 0x7E2A9C4B;
    const _0x8h9i = 0x3F7B5D8E;
    
    function _0x2e1f(expectedHash, input) {
        try {
            // Compute polynomial hash of input
            const cleanInput = input.toLowerCase().replace(/\s/g, '');
            let hash = 0;
            let pow = 1;
            
            for (let i = 0; i < cleanInput.length; i++) {
                hash = (hash + (cleanInput.charCodeAt(i) * pow) % _0xMod) % _0xMod;
                pow = (pow * _0xPrime) % _0xMod;
            }
            
            // Add salt based on input length and first character
            const salt = (cleanInput.length * 17 + cleanInput.charCodeAt(0) * 23) % _0xMod;
            hash = (hash + salt) % _0xMod;
            
            return hash === expectedHash;
        } catch(e) {
            return false;
        }
    }
    
    // Decoy validation function
    function _0x9j0k(hash, input) {
        return Math.random() > 0.5; // Always returns random result
    }
    
    // Glass transition function
    function transitionToNextPuzzle(currentPuzzleId, nextPuzzleId) {
        const currentPuzzleDiv = document.getElementById(currentPuzzleId);
        const nextPuzzleDiv = document.getElementById(nextPuzzleId);
        
        // Add glass glow effect to current puzzle
        currentPuzzleDiv.classList.add('glass-glow');
        
        // Fade out current puzzle
        setTimeout(() => {
            currentPuzzleDiv.classList.add('fade-out');
        }, 600);
        
        // Show and fade in next puzzle
        setTimeout(() => {
            currentPuzzleDiv.style.display = 'none';
            nextPuzzleDiv.style.display = 'block';
            nextPuzzleDiv.classList.add('fade-in');
            nextPuzzleDiv.style.opacity = '1';
            // Update current puzzle number
            if (nextPuzzleId === 'puzzle1') currentPuzzle = 1;
            else if (nextPuzzleId === 'puzzle2') currentPuzzle = 2;
            else if (nextPuzzleId === 'puzzle3') currentPuzzle = 3;
            else if (nextPuzzleId === 'puzzle4') currentPuzzle = 4;
        }, 900);
    }
    
    // Puzzle 1 handler
    document.getElementById('puzzle1-form').addEventListener('submit', function(e) {
        e.preventDefault();
        const input = this.querySelector('input');
        const button = this.querySelector('button');
        const rawAnswer = input.value.trim();
        const answer = rawAnswer.toLowerCase().replace(/\s/g, '');
        const messageDiv = document.getElementById('puzzle1-message');
        const isCorrect = _0x2e1f(_0x4f2a, answer);
        
        // Add visual feedback immediately
        addInteractionFeedback(isCorrect, 1, input, button, messageDiv);
        
        // Track puzzle attempt with Firebase
        if (typeof window.trackPuzzleEvent === 'function') {
            window.trackPuzzleEvent({
                eventType: 'puzzle_attempt',
                playerName: playerName,
                puzzleNumber: 1,
                answer: rawAnswer,
                isCorrect: isCorrect,
                category: 'puzzle_interaction',
                timeSpent: Date.now() - (window.puzzle1StartTime || Date.now())
            });
        }
        
        if (isCorrect) {
            messageDiv.className = 'glass-message positive success-message';
            messageDiv.textContent = `Excellent work, ${playerName}! 🔑 You solved the first puzzle!`;
            messageDiv.style.display = 'block';
            
            // Mark puzzle as completed
            completePuzzle(1);
            
            // Track success
            if (typeof window.trackPuzzleEvent === 'function') {
                window.trackPuzzleEvent({
                    eventType: 'puzzle_solved',
                    playerName: playerName,
                    puzzleNumber: 1,
                    category: 'puzzle_success'
                });
            }
            
            // Transition to puzzle 2 with glass effects
            setTimeout(() => {
                navigateToPuzzle(2);
                window.puzzle2StartTime = Date.now();
            }, 1200);
        } else {
            messageDiv.className = 'glass-message negative';
            messageDiv.textContent = 'Incorrect. Try again, you\'ve got this!';
            messageDiv.style.display = 'block';
        }
    });

    // Puzzle 2 handler
    document.getElementById('puzzle2-form').addEventListener('submit', function(e) {
        e.preventDefault();
        const input = this.querySelector('input');
        const button = this.querySelector('button');
        const rawAnswer = input.value.trim();
        const answer = rawAnswer.toLowerCase().replace(/\s/g, '');
        const messageDiv = document.getElementById('puzzle2-message');
        const isCorrect = _0x2e1f(_0x7b3c, answer);
        
        // Add visual feedback immediately
        addInteractionFeedback(isCorrect, 2, input, button, messageDiv);
        
        // Track puzzle attempt with Firebase
        if (typeof window.trackPuzzleEvent === 'function') {
            window.trackPuzzleEvent({
                eventType: 'puzzle_attempt',
                playerName: playerName,
                puzzleNumber: 2,
                answer: rawAnswer,
                isCorrect: isCorrect,
                category: 'puzzle_interaction',
                timeSpent: Date.now() - (window.puzzle2StartTime || Date.now())
            });
        }
        
        if (isCorrect) {
            messageDiv.className = 'glass-message positive success-message';
            messageDiv.textContent = `Outstanding, ${playerName}! 🗼 You solved the second puzzle!`;
            messageDiv.style.display = 'block';
            
            // Mark puzzle as completed
            completePuzzle(2);
            
            // Track success
            if (typeof window.trackPuzzleEvent === 'function') {
                window.trackPuzzleEvent({
                    eventType: 'puzzle_solved',
                    playerName: playerName,
                    puzzleNumber: 2,
                    category: 'puzzle_success'
                });
            }
            
            // Transition to puzzle 3 with glass effects
            setTimeout(() => {
                navigateToPuzzle(3);
                window.puzzle3StartTime = Date.now();
            }, 1200);
        } else {
            messageDiv.className = 'glass-message negative';
            messageDiv.textContent = 'Incorrect. Keep trying, you\'re doing great!';
            messageDiv.style.display = 'block';
        }
    });

    // Puzzle 3 handler
    document.getElementById('puzzle3-form').addEventListener('submit', function(e) {
        e.preventDefault();
        const input = this.querySelector('input');
        const button = this.querySelector('button');
        const rawAnswer = input.value.trim();
        const answer = rawAnswer.toLowerCase().replace(/\s/g, '');
        const messageDiv = document.getElementById('puzzle3-message');
        const isCorrect = _0x2e1f(_0x9d4e, answer);
        
        // Add visual feedback immediately
        addInteractionFeedback(isCorrect, 3, input, button, messageDiv);
        
        // Track puzzle attempt with Firebase
        if (typeof window.trackPuzzleEvent === 'function') {
            window.trackPuzzleEvent({
                eventType: 'puzzle_attempt',
                playerName: playerName,
                puzzleNumber: 3,
                answer: rawAnswer,
                isCorrect: isCorrect,
                category: 'puzzle_interaction',
                timeSpent: Date.now() - (window.puzzle3StartTime || Date.now())
            });
        }
        
        if (isCorrect) {
            messageDiv.className = 'glass-message positive success-message';
            messageDiv.textContent = `Excellent, ${playerName}! 🎯 You solved the third puzzle!`;
            messageDiv.style.display = 'block';
            
            // Mark puzzle as completed
            completePuzzle(3);
            
            // Track success
            if (typeof window.trackPuzzleEvent === 'function') {
                window.trackPuzzleEvent({
                    eventType: 'puzzle_solved',
                    playerName: playerName,
                    puzzleNumber: 3,
                    category: 'puzzle_success'
                });
            }
            
            // Transition to puzzle 4 with glass effects
            setTimeout(() => {
                navigateToPuzzle(4);
                window.puzzle4StartTime = Date.now();
            }, 1200);
        } else {
            messageDiv.className = 'glass-message negative';
            messageDiv.textContent = 'Incorrect. You\'re getting closer to the final challenge!';
            messageDiv.style.display = 'block';
        }
    });

    // Puzzle 4 handler (Final puzzle)
    document.getElementById('puzzle4-form').addEventListener('submit', function(e) {
        e.preventDefault();
        const input = this.querySelector('input');
        const button = this.querySelector('button');
        const rawAnswer = input.value.trim();
        const answer = rawAnswer.toLowerCase().replace(/\s/g, '');
        const messageDiv = document.getElementById('puzzle4-message');
        const isCorrect = _0x2e1f(_0x7f8g, answer);
        
        // Add visual feedback immediately
        addInteractionFeedback(isCorrect, 4, input, button, messageDiv);
        
        // Track puzzle attempt with Firebase
        if (typeof window.trackPuzzleEvent === 'function') {
            window.trackPuzzleEvent({
                eventType: 'puzzle_attempt',
                playerName: playerName,
                puzzleNumber: 4,
                answer: rawAnswer,
                isCorrect: isCorrect,
                category: 'puzzle_interaction',
                timeSpent: Date.now() - (window.puzzle4StartTime || Date.now())
            });
        }
        
        if (isCorrect) {
            messageDiv.className = 'glass-message positive success-message';
            messageDiv.textContent = `Congratulations, ${playerName}! 🌟 You solved all four puzzles! You're a true Seattle puzzle master!`;
            messageDiv.style.display = 'block';
            
            // Mark final puzzle as completed
            completePuzzle(4);
            
            // Track success and completion
            if (typeof window.trackPuzzleEvent === 'function') {
                window.trackPuzzleEvent({
                    eventType: 'puzzle_solved',
                    playerName: playerName,
                    puzzleNumber: 4,
                    category: 'puzzle_success'
                });
                
                window.trackPuzzleEvent({
                    eventType: 'game_completed',
                    playerName: playerName,
                    category: 'game_completion',
                    totalTime: Date.now() - (window.gameStartTime || Date.now())
                });
            }
            
            // Add final glass celebration effect and show credits
            setTimeout(() => {
                document.getElementById('puzzle4').classList.add('glass-glow');
                
                // Show credits card after a brief delay
                setTimeout(() => {
                    showCreditsCard();
                }, 2000);
            }, 1000);
        } else {
            messageDiv.className = 'glass-message negative';
            messageDiv.textContent = 'Incorrect. You\'re so close to completing the final challenge!';
            messageDiv.style.display = 'block';
        }
    });
    </script>


</body>
</html>
