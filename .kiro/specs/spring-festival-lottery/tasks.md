# 实施计划：春晚庙会抽奖网站

## 概述

本实施计划将春晚庙会抽奖网站的设计转化为可执行的开发任务。系统使用 React + TypeScript 构建，采用 localStorage 进行数据持久化。任务按照从核心功能到界面优化的顺序组织，确保每一步都能增量验证功能。

## 任务列表

- [x] 1. 搭建项目基础结构
  - 使用 Vite 创建 React + TypeScript 项目
  - 配置 TypeScript 编译选项
  - 设置项目目录结构（components、services、types、utils）
  - 安装必要的依赖（如果需要测试库，安装 vitest 和 fast-check）
  - _需求：所有需求的基础_

- [ ] 2. 实现数据模型和类型定义
  - [x] 2.1 创建 TypeScript 接口定义
    - 定义 Prize 接口（id, name, totalCount, remainingCount, description）
    - 定义 LotteryState 接口（prizes, currentResult, isDrawing, totalDrawn）
    - _需求：1.2, 1.4, 2.1_

  - [ ]* 2.2 为数据模型编写属性测试
    - **属性 2：奖品数量更新一致性**
    - **验证需求：1.4**

- [ ] 3. 实现数据持久化服务
  - [x] 3.1 创建 StorageService 类
    - 实现 saveState() 方法（序列化为 JSON 并保存到 localStorage）
    - 实现 loadState() 方法（从 localStorage 加载并反序列化）
    - 实现 clearState() 方法（清除 localStorage 数据）
    - 添加错误处理（localStorage 不可用、数据损坏等情况）
    - _需求：4.1, 4.2, 4.3, 4.4_

  - [ ]* 3.2 为存储服务编写属性测试
    - **属性 5：状态序列化往返一致性**
    - **验证需求：4.1, 4.3**

  - [ ]* 3.3 为存储服务编写单元测试
    - 测试保存和加载有效状态
    - 测试处理空存储的情况
    - 测试处理损坏数据的情况
    - _需求：4.4_

- [ ] 4. 实现奖品管理逻辑
  - [x] 4.1 创建 PrizeManager 类
    - 实现 addPrize() 方法（生成唯一 ID，验证输入）
    - 实现 updatePrizeCount() 方法（更新指定奖品的数量）
    - 实现 removePrize() 方法（删除指定奖品）
    - 实现 getAllPrizes() 方法（返回所有奖品列表）
    - 实现 getAvailablePrizes() 方法（返回剩余数量 > 0 的奖品）
    - _需求：1.1, 1.2, 1.4_

  - [ ]* 4.2 为奖品管理编写属性测试
    - **属性 1：奖品数量验证**
    - **验证需求：1.3**

  - [ ]* 4.3 为奖品管理编写单元测试
    - 测试添加有效奖品
    - 测试更新奖品数量
    - 测试删除奖品
    - 测试输入验证（空名称、负数、零）
    - _需求：1.2, 1.3, 1.4_

- [ ] 5. 实现抽奖引擎
  - [x] 5.1 创建 LotteryEngine 类
    - 实现 draw() 方法（加权随机算法选择奖品）
    - 实现 hasAvailablePrizes() 方法（检查是否有可抽取奖品）
    - 实现 decrementPrize() 方法（减少奖品数量）
    - 实现 reset() 方法（重置所有奖品到初始状态）
    - _需求：2.1, 2.2, 2.3, 2.4, 5.3, 5.4_

  - [ ]* 5.2 为抽奖引擎编写属性测试 - 结果有效性
    - **属性 3：抽奖结果来自可用奖品池**
    - **验证需求：2.1, 2.3**

  - [ ]* 5.3 为抽奖引擎编写属性测试 - 数量递减
    - **属性 4：抽奖减少奖品数量**
    - **验证需求：2.2**

  - [ ]* 5.4 为抽奖引擎编写属性测试 - 重置功能
    - **属性 7：重置清空所有数据**
    - **验证需求：5.3, 5.4, 5.5**

  - [ ]* 5.5 为抽奖引擎编写单元测试
    - 测试从多个奖品中抽取
    - 测试抽取最后一个奖品
    - 测试从空池中抽取（应返回 null）
    - 测试重置功能
    - _需求：2.1, 2.2, 2.3, 2.4, 5.3_

- [x] 6. 检查点 - 确保核心逻辑测试通过
  - 确保所有测试通过，如有问题请询问用户

- [ ] 7. 创建 React 状态管理
  - [x] 7.1 创建自定义 Hook：useLotteryState
    - 使用 useState 管理 LotteryState
    - 集成 StorageService 实现自动保存
    - 提供操作方法（addPrize, updatePrize, removePrize, draw, reset）
    - 在组件挂载时从 localStorage 加载状态
    - _需求：1.1, 1.4, 2.1, 4.1, 4.2, 5.3_

  - [ ]* 7.2 为状态管理编写属性测试
    - **属性 6：抽奖后持久化一致性**
    - **验证需求：4.2**

- [ ] 8. 实现奖品配置界面组件
  - [x] 8.1 创建 PrizeConfigForm 组件
    - 输入框：奖品名称、奖品数量、奖品描述（可选）
    - "添加奖品"按钮
    - 输入验证和错误提示
    - _需求：1.1, 1.2, 1.3_

  - [ ] 8.2 创建 PrizeList 组件
    - 显示所有已配置奖品的列表
    - 显示每个奖品的名称、总数量、剩余数量
    - 提供编辑和删除按钮
    - _需求：1.4, 1.5_

- [ ] 9. 实现抽奖界面组件
  - [ ] 9.1 创建 LotteryButton 组件
    - "开始抽奖"按钮
    - 根据是否有可用奖品动态启用/禁用
    - 显示当前奖品池状态（剩余总数）
    - _需求：2.1, 2.4_

  - [ ] 9.2 创建 LotteryAnimation 组件
    - 实现抽奖动画效果（如滚动、闪烁等）
    - 在抽奖过程中显示加载状态
    - _需求：2.5, 3.2_

- [ ] 10. 实现抽奖结果展示组件
  - [ ] 10.1 创建 ResultDisplay 组件
    - 以大字体突出显示中奖奖项名称
    - 显示奖品描述（如果有）
    - 添加春节主题装饰元素（使用 CSS 或 SVG）
    - 使用春节配色方案（红色、金色）
    - 确保高对比度，适合拍照
    - _需求：3.1, 3.4, 3.5, 3.6, 3.7, 6.4_

  - [ ] 10.2 添加春节主题视觉效果
    - 添加烟花动画效果（CSS 动画或 Canvas）
    - 添加灯笼、福字等装饰元素
    - 添加祝福语文案
    - _需求：3.6_

- [ ] 11. 实现重置功能
  - [ ] 11.1 创建 ResetButton 组件
    - "重置系统"按钮
    - 点击时显示确认对话框
    - 确认后调用 reset() 方法
    - _需求：5.1, 5.2, 5.3, 5.4, 5.5_

- [ ] 12. 组装主应用组件
  - [ ] 12.1 创建 App 组件
    - 整合所有子组件
    - 实现页面布局（配置区、抽奖区、结果区）
    - 添加应用标题和说明
    - _需求：所有需求_

  - [ ] 12.2 添加全局样式
    - 设置春节主题配色
    - 设置大字体以便远距离观看
    - 确保按钮和交互元素清晰可见
    - 添加响应式布局（针对桌面浏览器优化）
    - _需求：6.1, 6.2, 6.3, 6.4, 6.5_

- [ ]* 13. 编写集成测试
  - 测试完整抽奖流程：配置 → 抽奖 → 查看结果 → 重置
  - 测试持久化流程：配置 → 保存 → 刷新页面 → 验证恢复
  - 测试边界流程：抽完所有奖品 → 验证禁用状态
  - _需求：所有需求_

- [ ] 14. 最终检查点 - 确保所有测试通过
  - 确保所有测试通过，如有问题请询问用户

## 注意事项

- 标记为 `*` 的任务是可选的，可以跳过以更快实现 MVP
- 每个任务都引用了具体的需求以便追溯
- 检查点确保增量验证
- 属性测试验证通用正确性属性
- 单元测试验证特定示例和边界情况
